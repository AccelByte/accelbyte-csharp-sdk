#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 512
# - template file: cli-test.j2

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..34"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 AdminGetChallenges
$CLI_EXE \
    --sn challenge \
    --op AdminGetChallenges \
    --namespace $AB_NAMESPACE \
    --limit '2' \
    --offset '56' \
    --sortBy 'i3wMWnoZgIhwb8YY' \
    --status 'TIED' \
    > test.out 2>&1
eval_tap $? 2 'AdminGetChallenges' test.out

#- 3 AdminCreateChallenge
# body param: body
echo '{"activeGoalsPerRotation": 76, "assignmentRule": "RANDOMIZED", "code": "bemSBELbZ0VBUGA7", "description": "nkDeev2Oj060HnOf", "endAfter": 71, "endDate": "1993-12-30T00:00:00Z", "goalsVisibility": "PERIODONLY", "name": "X1LxkZs4233oQWoX", "randomizedPerRotation": false, "repeatAfter": 8, "resetConfig": {"resetDate": 45, "resetDay": 34, "resetTime": "KvzESbhpxlDdEs4i"}, "rotation": "DAILY", "startDate": "1979-01-26T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminCreateChallenge \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 3 'AdminCreateChallenge' test.out

#- 4 AdminGetActiveChallenges
$CLI_EXE \
    --sn challenge \
    --op AdminGetActiveChallenges \
    --namespace $AB_NAMESPACE \
    --userId 'E3r5AQUBqS8KtTYZ' \
    --limit '77' \
    --offset '4' \
    > test.out 2>&1
eval_tap $? 4 'AdminGetActiveChallenges' test.out

#- 5 AdminGetChallenge
$CLI_EXE \
    --sn challenge \
    --op AdminGetChallenge \
    --challengeCode 'J58QqcV3IcuNs9MF' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 5 'AdminGetChallenge' test.out

#- 6 AdminUpdateChallenge
# body param: body
echo '{"activeGoalsPerRotation": 57, "assignmentRule": "FIXED", "description": "T2KD18yrWorpC65V", "endAfter": 73, "endDate": "1973-03-02T00:00:00Z", "goalsVisibility": "PERIODONLY", "name": "4q1z1KJmKedBfbWv", "randomizedPerRotation": false, "repeatAfter": 1, "resetConfig": {"resetDate": 16, "resetDay": 10, "resetTime": "Ou124TsbQsxYFxGG"}, "rotation": "NONE", "startDate": "1995-02-14T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminUpdateChallenge \
    --challengeCode 'vqDSU3PDyIAGfGq1' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 6 'AdminUpdateChallenge' test.out

#- 7 AdminDeleteChallenge
$CLI_EXE \
    --sn challenge \
    --op AdminDeleteChallenge \
    --challengeCode 'FNmRWvUvDPnKoECj' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 7 'AdminDeleteChallenge' test.out

#- 8 AdminGetGoals
$CLI_EXE \
    --sn challenge \
    --op AdminGetGoals \
    --challengeCode 'GUg867xodwuG14ID' \
    --namespace $AB_NAMESPACE \
    --limit '24' \
    --offset '68' \
    --sortBy '5wj6K2wEMnckjlW6' \
    > test.out 2>&1
eval_tap $? 8 'AdminGetGoals' test.out

#- 9 AdminCreateGoal
# body param: body
echo '{"code": "BywsSSZTGlubsmhj", "description": "XcScOUvrjJBO7tbk", "isActive": true, "name": "GYKqRMSTisP0MrSd", "requirementGroups": [{"operator": "AND", "predicates": [{"matcher": "LESS_THAN", "parameterName": "Fy0pJYCdfkfyt09r", "parameterType": "ENTITLEMENT", "statCycleId": "Ojpls9BZTYc5BsdS", "targetValue": 0.7164734306934746}, {"matcher": "GREATER_THAN", "parameterName": "aAzzn4GbgkKeCaS6", "parameterType": "STATISTIC", "statCycleId": "1nq4Hf32SL5PjaYE", "targetValue": 0.4807151381639043}, {"matcher": "LESS_THAN", "parameterName": "qv7WmCuqcsNM7YAn", "parameterType": "ACHIEVEMENT", "statCycleId": "QfucSq2X8gFuJORk", "targetValue": 0.9073517761952155}]}, {"operator": "AND", "predicates": [{"matcher": "GREATER_THAN", "parameterName": "YfnXTsQUrA0WWyKl", "parameterType": "ACHIEVEMENT", "statCycleId": "K5mCSoGeQCahcox6", "targetValue": 0.892668353216679}, {"matcher": "EQUAL", "parameterName": "f2Hwi7vg3osbh0fL", "parameterType": "STATISTIC_CYCLE", "statCycleId": "h7eJvAS2W4uqkhwS", "targetValue": 0.46084870515883536}, {"matcher": "LESS_THAN", "parameterName": "qzhN0YdGSrA9LXRw", "parameterType": "ENTITLEMENT", "statCycleId": "LgpQE9nXzhBC0uyM", "targetValue": 0.6939989426764861}]}, {"operator": "AND", "predicates": [{"matcher": "EQUAL", "parameterName": "WXrdZaFeacGT2x6o", "parameterType": "STATISTIC_CYCLE", "statCycleId": "8Njxyw7RHldq0m7N", "targetValue": 0.15493470151047362}, {"matcher": "LESS_THAN_EQUAL", "parameterName": "Z95Z5XDLBN9YGVPt", "parameterType": "ENTITLEMENT", "statCycleId": "AkcyAy4drHlPcXGG", "targetValue": 0.1814296756879875}, {"matcher": "GREATER_THAN", "parameterName": "w3veBfrpCrnbaxhE", "parameterType": "STATISTIC", "statCycleId": "AqUNFDtXnXLvOAsW", "targetValue": 0.9769939427652791}]}], "rewards": [{"itemId": "wYh4gq7pRVZVLJiD", "itemName": "x3au9b9QjhzDlnJm", "qty": 0.1394628797757611, "type": "ENTITLEMENT"}, {"itemId": "TMIczbYilOziwG8C", "itemName": "PLOzSZm9K3cMY617", "qty": 0.5446165706476169, "type": "STATISTIC"}, {"itemId": "CYZaL46I3PgCcQ0a", "itemName": "xTWnmyEYLZQTpvLH", "qty": 0.9365046548673698, "type": "STATISTIC"}], "schedule": {"endTime": "1992-07-01T00:00:00Z", "order": 62, "startTime": "1980-08-14T00:00:00Z"}, "tags": ["SzYnrcetxObeisZe", "lKuD0iJ6fs3zL9H4", "WxGWRH7fz4BdPhLt"]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminCreateGoal \
    --challengeCode 'HRJOImSq37aeAaGq' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'AdminCreateGoal' test.out

#- 10 AdminGetGoal
$CLI_EXE \
    --sn challenge \
    --op AdminGetGoal \
    --challengeCode '0NIj53gXkmrayvcI' \
    --code 'YiWxIAxfvLzSpDFY' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 10 'AdminGetGoal' test.out

#- 11 AdminUpdateGoals
# body param: body
echo '{"description": "3lxe16KsSRzkf2Hz", "isActive": true, "name": "yVcQuvDbGMqbEHkC", "requirementGroups": [{"operator": "AND", "predicates": [{"matcher": "GREATER_THAN_EQUAL", "parameterName": "JGnUyCMEbHh1uE4D", "parameterType": "ENTITLEMENT", "statCycleId": "J0uCjjaNCRV3hSIi", "targetValue": 0.7382628089858457}, {"matcher": "LESS_THAN", "parameterName": "Jp2f9f1FCoIo3L24", "parameterType": "STATISTIC_CYCLE", "statCycleId": "8mQir1Af0G6OrPH6", "targetValue": 0.8380355644838001}, {"matcher": "GREATER_THAN_EQUAL", "parameterName": "LVu27iwplLJdzYS9", "parameterType": "USERACCOUNT", "statCycleId": "M9Qc5HmR0vknXO45", "targetValue": 0.4334923310666631}]}, {"operator": "AND", "predicates": [{"matcher": "GREATER_THAN_EQUAL", "parameterName": "NXSTItt35OJTfJBZ", "parameterType": "STATISTIC", "statCycleId": "62yI9g5RDrlzPFQm", "targetValue": 0.6329432900421776}, {"matcher": "GREATER_THAN_EQUAL", "parameterName": "1DzPHux3k3skhn3m", "parameterType": "ENTITLEMENT", "statCycleId": "ZjTYM95e4aa8xOJu", "targetValue": 0.9519274654184922}, {"matcher": "GREATER_THAN_EQUAL", "parameterName": "qSNylcljuNM3eUUS", "parameterType": "STATISTIC_CYCLE", "statCycleId": "Fpff2vDkz68zorEg", "targetValue": 0.047070631500480076}]}, {"operator": "AND", "predicates": [{"matcher": "LESS_THAN", "parameterName": "L98WUoXvfU4qMIpf", "parameterType": "ACHIEVEMENT", "statCycleId": "CpNtJSMm8kDi3Rwu", "targetValue": 0.020938008373402872}, {"matcher": "GREATER_THAN_EQUAL", "parameterName": "wWs6IpYBxafo9b4x", "parameterType": "USERACCOUNT", "statCycleId": "VLfjsw270pMmOQJr", "targetValue": 0.2437169525183489}, {"matcher": "LESS_THAN", "parameterName": "9yO0vyD6J5brVo20", "parameterType": "ACHIEVEMENT", "statCycleId": "zV9hzsVbpJLtEZju", "targetValue": 0.39316649585726526}]}], "rewards": [{"itemId": "FhvbxX2DNbknfVv4", "itemName": "nm70TCayYAkF18YB", "qty": 0.36126058048622267, "type": "STATISTIC"}, {"itemId": "cGkPgQ0hb2tLrsMe", "itemName": "oZiRYkbhEM1zTNY3", "qty": 0.19172099240094942, "type": "ENTITLEMENT"}, {"itemId": "jlpk8lfuiJVcktlx", "itemName": "9zJZVVCc9bpIHEWQ", "qty": 0.6146974503926308, "type": "ENTITLEMENT"}], "schedule": {"endTime": "1972-08-21T00:00:00Z", "order": 87, "startTime": "1976-04-17T00:00:00Z"}, "tags": ["IqwqpoTVCNrcaVoz", "sjIXO2EUsAfBvo6L", "lcalks2R3VMtipTV"]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminUpdateGoals \
    --challengeCode 'xXAF8KhOKqbrECij' \
    --code 'FxOpOzxeTLJQsZcT' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 11 'AdminUpdateGoals' test.out

#- 12 AdminDeleteGoal
$CLI_EXE \
    --sn challenge \
    --op AdminDeleteGoal \
    --challengeCode 'EzXaXUzpsAV6ct6X' \
    --code 'ITL0QEkadMSQluAo' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 12 'AdminDeleteGoal' test.out

#- 13 AdminGetPeriods
$CLI_EXE \
    --sn challenge \
    --op AdminGetPeriods \
    --challengeCode 'ED9oYwS8oLyErKvR' \
    --namespace $AB_NAMESPACE \
    --limit '39' \
    --offset '55' \
    > test.out 2>&1
eval_tap $? 13 'AdminGetPeriods' test.out

#- 14 AdminRandomizeChallenge
$CLI_EXE \
    --sn challenge \
    --op AdminRandomizeChallenge \
    --challengeCode 'HFGJRoGW7VBG1VB2' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 14 'AdminRandomizeChallenge' test.out

#- 15 AdminDeleteTiedChallenge
$CLI_EXE \
    --sn challenge \
    --op AdminDeleteTiedChallenge \
    --challengeCode 'sp2x9mszGGoyhGZA' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 15 'AdminDeleteTiedChallenge' test.out

#- 16 AdminUpdateTiedChallengeSchedule
# body param: body
echo '{"action": "STOP", "endDate": "1995-06-07T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminUpdateTiedChallengeSchedule \
    --challengeCode 'dINXzvkSp0WbvxQW' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 16 'AdminUpdateTiedChallengeSchedule' test.out

#- 17 AdminGetAssignmentPlugin
$CLI_EXE \
    --sn challenge \
    --op AdminGetAssignmentPlugin \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 17 'AdminGetAssignmentPlugin' test.out

#- 18 AdminUpdateAssignmentPlugin
# body param: body
echo '{"appName": "I0QGCOx7eICkauWb", "extendType": "APP", "grpcServerAddress": "rSnU7d1BuhdwliTS"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminUpdateAssignmentPlugin \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 18 'AdminUpdateAssignmentPlugin' test.out

#- 19 AdminCreateAssignmentPlugin
# body param: body
echo '{"appName": "DdmGVfegiD3mrVQa", "extendType": "APP", "grpcServerAddress": "r3oT88Dfc7114QFG"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminCreateAssignmentPlugin \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 19 'AdminCreateAssignmentPlugin' test.out

#- 20 AdminDeleteAssignmentPlugin
$CLI_EXE \
    --sn challenge \
    --op AdminDeleteAssignmentPlugin \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'AdminDeleteAssignmentPlugin' test.out

#- 21 AdminEvaluateProgress
# body param: body
echo '{"userIds": ["wTzBVDg5v71kGCEt", "7h1mVwIQCJmQkvWb", "Qrn2W0VkOF0pQOY0"]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminEvaluateProgress \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 21 'AdminEvaluateProgress' test.out

#- 22 AdminClaimUsersRewards
# body param: body
echo '[{"rewardIds": ["UCcViiFKNjkT5hcO", "NCaOyATBFgqLeAzv", "dcUEhWRo6ROvbuPQ"], "userId": "wl9dVfJQGkDR00of"}, {"rewardIds": ["XsbnEzHiRs0NmGhx", "v1vuN7Xv6OuG6RR1", "jPh8RblvnfNiABRf"], "userId": "1gdXM7QlAlnjAfgx"}, {"rewardIds": ["OdZdf9tLHO1qrNyh", "mUEADczzrL31HuYK", "sCBBgwb1hGjHJgxr"], "userId": "cEvnfJqU4hCv5egS"}]' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminClaimUsersRewards \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 22 'AdminClaimUsersRewards' test.out

#- 23 AdminClaimUserRewardsByGoalCode
# body param: body
echo '{"goalCode": "QDePKSZKp6zwDQS1"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminClaimUserRewardsByGoalCode \
    --challengeCode 'atvJrALaiplJgRhe' \
    --namespace $AB_NAMESPACE \
    --userId 'dl5Ewh3jDayYStUi' \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 23 'AdminClaimUserRewardsByGoalCode' test.out

#- 24 AdminGetUserProgression
$CLI_EXE \
    --sn challenge \
    --op AdminGetUserProgression \
    --challengeCode 'BB1yz3iP8gH88Uen' \
    --namespace $AB_NAMESPACE \
    --userId 'lMVzIOP8NOf91LsD' \
    --dateTime '1987-01-16T00:00:00Z' \
    --goalCode 'cRwSoMTuJziuDNbO' \
    --limit '50' \
    --offset '7' \
    --tags '["ftYZkBXiEhdiS41V", "BAEUvoBlbH02bobx", "tljIfHBgjP9onbxF"]' \
    > test.out 2>&1
eval_tap $? 24 'AdminGetUserProgression' test.out

#- 25 AdminGetUserRewards
$CLI_EXE \
    --sn challenge \
    --op AdminGetUserRewards \
    --namespace $AB_NAMESPACE \
    --userId 'cxS2OZZfXO3HkJTO' \
    --limit '86' \
    --offset '38' \
    --sortBy '2AopmjI7CbY2WuwR' \
    --status 'UNCLAIMED' \
    > test.out 2>&1
eval_tap $? 25 'AdminGetUserRewards' test.out

#- 26 AdminClaimUserRewards
# body param: body
echo '{"rewardIDs": ["9IivgC4mJ5OHuNEV", "QK4Mvk00I9GqAhhj", "NIivdIcaEQfNETQC"]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op AdminClaimUserRewards \
    --namespace $AB_NAMESPACE \
    --userId 'BPK1mYwKVQoydbYj' \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 26 'AdminClaimUserRewards' test.out

#- 27 GetChallenges
$CLI_EXE \
    --sn challenge \
    --op GetChallenges \
    --namespace $AB_NAMESPACE \
    --limit '77' \
    --offset '11' \
    --sortBy 'yBpqhCJBtFOm3iCp' \
    --status 'RETIRED' \
    > test.out 2>&1
eval_tap $? 27 'GetChallenges' test.out

#- 28 PublicGetScheduledGoals
$CLI_EXE \
    --sn challenge \
    --op PublicGetScheduledGoals \
    --challengeCode 'PVZQaoEY2zrpLuvr' \
    --namespace $AB_NAMESPACE \
    --limit '47' \
    --offset '63' \
    --tags '["96OOz45vMiR3QYZJ", "KVNlK8PTaIXRWFTy", "A9MDnKGXqq7Zk705"]' \
    > test.out 2>&1
eval_tap $? 28 'PublicGetScheduledGoals' test.out

#- 29 PublicClaimUserRewardsByGoalCode
# body param: body
echo '{"goalCode": "hOhenJi6dNVF7zwj"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op PublicClaimUserRewardsByGoalCode \
    --challengeCode 'XqlcD2LzaOwIF5tE' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 29 'PublicClaimUserRewardsByGoalCode' test.out

#- 30 EvaluateMyProgress
$CLI_EXE \
    --sn challenge \
    --op EvaluateMyProgress \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 30 'EvaluateMyProgress' test.out

#- 31 PublicGetUserProgression
$CLI_EXE \
    --sn challenge \
    --op PublicGetUserProgression \
    --challengeCode 'sCwoAVcZCSj80gzF' \
    --namespace $AB_NAMESPACE \
    --dateTime '1982-05-07T00:00:00Z' \
    --goalCode 'gHA4CaLsPqRsTdKz' \
    --limit '4' \
    --offset '90' \
    --tags '["KtkGcvn44NWse6VL", "PkM1VTrQBywhJ7lb", "BLw9xy1WQM5qUS8b"]' \
    > test.out 2>&1
eval_tap $? 31 'PublicGetUserProgression' test.out

#- 32 PublicGetPastUserProgression
$CLI_EXE \
    --sn challenge \
    --op PublicGetPastUserProgression \
    --challengeCode 'aUqkzSr41y6RPBHJ' \
    --index '42' \
    --namespace $AB_NAMESPACE \
    --goalCode 'pNjHWPcFSnM7GAvk' \
    --limit '94' \
    --offset '30' \
    --tags '["sXDish7KUVhmAwmA", "ygsnn8pM7l6v0elL", "MceGGgb5FJHWE6s1"]' \
    > test.out 2>&1
eval_tap $? 32 'PublicGetPastUserProgression' test.out

#- 33 PublicGetUserRewards
$CLI_EXE \
    --sn challenge \
    --op PublicGetUserRewards \
    --namespace $AB_NAMESPACE \
    --limit '12' \
    --offset '2' \
    --sortBy 'kXDY7jnhp3qY6T7T' \
    --status 'UNCLAIMED' \
    > test.out 2>&1
eval_tap $? 33 'PublicGetUserRewards' test.out

#- 34 PublicClaimUserRewards
# body param: body
echo '{"rewardIDs": ["86E90E4ZboiXT1Uy", "0gArtDpQE4bOtoiA", "jHXcVVOsVywU6uis"]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn challenge \
    --op PublicClaimUserRewards \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 34 'PublicClaimUserRewards' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE