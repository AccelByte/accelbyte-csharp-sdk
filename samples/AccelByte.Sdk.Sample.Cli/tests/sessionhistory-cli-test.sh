#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 512
# - template file: cli-test.j2

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..3"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 CreateXrayTicketObservability
# body param: body
echo '{"action": "bBuz5zkoaUEzGS3q", "activeAllianceRule": {"max_number": 12, "min_number": 79, "player_max_number": 76, "player_min_number": 85}, "activeMatchingRule": [{"attribute": "qpQwkRRHkaiKsmIi", "criteria": "RLR3IlNJKxhPfWV6", "reference": 0.05849060362180469}, {"attribute": "IabcFbSmeuIBroF7", "criteria": "bwRgwKvzESbhpxlD", "reference": 0.06357235639685577}, {"attribute": "Es4igdKeLmy8tZ5G", "criteria": "Zi5P12c61ts3fMI0", "reference": 0.9185922468845037}], "function": "rm2jUc9iav3tTqlE", "gameMode": "9oLDPD0Lfle8ESU1", "isBackfillMatch": false, "isRuleSetFlexed": false, "iteration": 6, "matchID": "nVaEyjmifJDYa1TJ", "namespace": "PUszmFGEkJVvqDSU", "remainingPlayersPerTicket": [17, 86, 54], "remainingTickets": 61, "sessionTickID": "5IZPqCqp9vcyt67W", "tickID": 54, "ticketID": "DPnKoECjGUg867xo", "timeToMatchSec": 0.06187913964219971, "timestamp": "1982-06-17T00:00:00Z", "unbackfillReason": "uRdNO08HN6s9p8Y5", "unmatchReason": "c9eItJtiNmY3y3n2"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op CreateXrayTicketObservability \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 2 'CreateXrayTicketObservability' test.out

#- 3 CreateXrayBulkTicketObservability
# body param: body
echo '{"ticketObservabilities": [{"action": "Rim4NBqhuNtj8FOv", "activeAllianceRule": {"max_number": 74, "min_number": 73, "player_max_number": 57, "player_min_number": 18}, "activeMatchingRule": [{"attribute": "O7tbkTGYKqRMSTis", "criteria": "P0MrSdaFy0pJYCdf", "reference": 0.16766109155868225}, {"attribute": "fyt09ro5fHdWqJTN", "criteria": "jrmpnnEckHH8kT9o", "reference": 0.8050246544789694}, {"attribute": "Vandercf1nq4Hf32", "criteria": "SL5PjaYEDxaYN8w9", "reference": 0.5953893755285063}], "function": "UW0py8KrcQfucSq2", "gameMode": "X8gFuJORk4j04Yfn", "isBackfillMatch": true, "isRuleSetFlexed": true, "iteration": 1, "matchID": "QUrA0WWyKl2K5mCS", "namespace": "oGeQCahcox63cyDx", "remainingPlayersPerTicket": [54, 16, 55], "remainingTickets": 43, "sessionTickID": "cRXJdoSTxNCK9AIj", "tickID": 81, "ticketID": "S2W4uqkhwSC7Eajw", "timeToMatchSec": 0.533680288800329, "timestamp": "1991-01-28T00:00:00Z", "unbackfillReason": "LfvwPewrf19Njm50", "unmatchReason": "xCDlPeNq0CvMXtyU"}, {"action": "WXrdZaFeacGT2x6o", "activeAllianceRule": {"max_number": 48, "min_number": 0, "player_max_number": 80, "player_min_number": 54}, "activeMatchingRule": [{"attribute": "jxyw7RHldq0m7NjU", "criteria": "Z95Z5XDLBN9YGVPt", "reference": 0.16651764080109377}, {"attribute": "jt0OyBlJi4RbZ0Iy", "criteria": "11mfOFjCzZVcGomW", "reference": 0.5057263160124127}, {"attribute": "1oAqUNFDtXnXLvOA", "criteria": "sW8wYh4gq7pRVZVL", "reference": 0.5771750721703145}], "function": "iDx3au9b9QjhzDln", "gameMode": "Jmi4XaBTgoXjfdUQ", "isBackfillMatch": false, "isRuleSetFlexed": false, "iteration": 45, "matchID": "3RxspSqwdbTR2sgz", "namespace": "faQrUCW9fgo69uv1", "remainingPlayersPerTicket": [3, 58, 22], "remainingTickets": 4, "sessionTickID": "Fx8DmbC9UqYdYrdx", "tickID": 80, "ticketID": "vLH6QPEBP8kSSFje", "timeToMatchSec": 0.3265060682301323, "timestamp": "1990-01-10T00:00:00Z", "unbackfillReason": "3wQQPYwmYFbxRvHY", "unmatchReason": "DCYwoGdmzXgf1ewU"}, {"action": "Tvnu0ensa3MZF7DT", "activeAllianceRule": {"max_number": 38, "min_number": 10, "player_max_number": 46, "player_min_number": 54}, "activeMatchingRule": [{"attribute": "nkSyuJTVjKQ1ORLE", "criteria": "IAePvDO2xkVgyRk1", "reference": 0.8522269462852442}, {"attribute": "b27RdU8VceYQ9erP", "criteria": "YQ5yVcQuvDbGMqbE", "reference": 0.5357402037361735}, {"attribute": "kCQwMBcQUNPHN8YZ", "criteria": "T0yJJ0uCjjaNCRV3", "reference": 0.11569235865886862}], "function": "SIiTEoTCSxjAqg9o", "gameMode": "GVEdC8mQir1Af0G6", "isBackfillMatch": true, "isRuleSetFlexed": false, "iteration": 68, "matchID": "uQBLVu27iwplLJdz", "namespace": "YS9K0VvwE6MAqPc8", "remainingPlayersPerTicket": [23, 83, 66], "remainingTickets": 70, "sessionTickID": "5AUtNXSTItt35OJT", "tickID": 11, "ticketID": "lq1jv60HTnmFrl3g", "timeToMatchSec": 0.8200816711504859, "timestamp": "1983-09-17T00:00:00Z", "unbackfillReason": "6Xmv1DzPHux3k3sk", "unmatchReason": "hn3mWZjTYM95e4aa"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op CreateXrayBulkTicketObservability \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 3 'CreateXrayBulkTicketObservability' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE