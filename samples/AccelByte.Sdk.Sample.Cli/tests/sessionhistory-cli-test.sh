#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 512
# - template file: cli-test.j2

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..37"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn sessionhistory \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 GetHealthcheckInfoV1
$CLI_EXE \
    --sn sessionhistory \
    --op GetHealthcheckInfoV1 \
    > test.out 2>&1
eval_tap $? 3 'GetHealthcheckInfoV1' test.out

#- 4 AdminGetLogConfig
$CLI_EXE \
    --sn sessionhistory \
    --op AdminGetLogConfig \
    > test.out 2>&1
eval_tap $? 4 'AdminGetLogConfig' test.out

#- 5 AdminPatchUpdateLogConfig
# body param: body
echo '{"logLevel": "debug"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op AdminPatchUpdateLogConfig \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'AdminPatchUpdateLogConfig' test.out

#- 6 AdminQueryGameSessionDetail
$CLI_EXE \
    --sn sessionhistory \
    --op AdminQueryGameSessionDetail \
    --namespace $AB_NAMESPACE \
    --endDate 'Yi3wMWnoZgIhwb8Y' \
    --gameSessionID 'YMLqpQwkRRHkaiKs' \
    --limit '25' \
    --offset '66' \
    --order 'IiRLR3IlNJKxhPfW' \
    --orderBy 'V6dIabcFbSmeuIBr' \
    --startDate 'oF7bwRgwKvzESbhp' \
    --userID 'xlDdEs4igdKeLmy8' \
    > test.out 2>&1
eval_tap $? 6 'AdminQueryGameSessionDetail' test.out

#- 7 GetGameSessionDetail
$CLI_EXE \
    --sn sessionhistory \
    --op GetGameSessionDetail \
    --namespace $AB_NAMESPACE \
    --sessionId 'tZ5GZi5P12c61ts3' \
    > test.out 2>&1
eval_tap $? 7 'GetGameSessionDetail' test.out

#- 8 AdminQueryMatchmakingDetail
$CLI_EXE \
    --sn sessionhistory \
    --op AdminQueryMatchmakingDetail \
    --namespace $AB_NAMESPACE \
    --gameSessionID 'fMI04rm2jUc9iav3' \
    --limit '41' \
    --offset '94' \
    --order '8yrWorpC65VJh4q1' \
    --orderBy 'z1KJmKedBfbWvKa5' \
    --ticketID 'Ou124TsbQsxYFxGG' \
    --userID 'HrfQkgXkiA5IZPqC' \
    > test.out 2>&1
eval_tap $? 8 'AdminQueryMatchmakingDetail' test.out

#- 9 AdminGetMatchmakingDetailBySessionID
$CLI_EXE \
    --sn sessionhistory \
    --op AdminGetMatchmakingDetailBySessionID \
    --namespace $AB_NAMESPACE \
    --sessionId 'qp9vcyt67WAfWXfU' \
    > test.out 2>&1
eval_tap $? 9 'AdminGetMatchmakingDetailBySessionID' test.out

#- 10 AdminGetMatchmakingDetailByTicketID
$CLI_EXE \
    --sn sessionhistory \
    --op AdminGetMatchmakingDetailByTicketID \
    --namespace $AB_NAMESPACE \
    --ticketId 'fwGB03tz8qIH4uRd' \
    > test.out 2>&1
eval_tap $? 10 'AdminGetMatchmakingDetailByTicketID' test.out

#- 11 AdminQueryPartyDetail
$CLI_EXE \
    --sn sessionhistory \
    --op AdminQueryPartyDetail \
    --namespace $AB_NAMESPACE \
    --limit '82' \
    --offset '72' \
    --order 'O08HN6s9p8Y5c9eI' \
    --orderBy 'tJtiNmY3y3n2Rim4' \
    --partyID 'NBqhuNtj8FOvKZjs' \
    --userID '1tLpERf77LzPoORB' \
    > test.out 2>&1
eval_tap $? 11 'AdminQueryPartyDetail' test.out

#- 12 GetPartyDetail
$CLI_EXE \
    --sn sessionhistory \
    --op GetPartyDetail \
    --namespace $AB_NAMESPACE \
    --sessionId 'kRmZ0A2zyZsb4FvW' \
    > test.out 2>&1
eval_tap $? 12 'GetPartyDetail' test.out

#- 13 AdminQueryTicketDetail
$CLI_EXE \
    --sn sessionhistory \
    --op AdminQueryTicketDetail \
    --namespace $AB_NAMESPACE \
    --endDate 'FIHPIbOjpls9BZTY' \
    --gameMode 'c5BsdSSVaAzzn4Gb' \
    --limit '13' \
    --offset '97' \
    --order 'kKeCaS6qyUCscHXs' \
    --partyID '8PlOBlfUOqv7WmCu' \
    --region 'qcsNM7YAnbq4DjmY' \
    --startDate 'UMhD9qU89D356pVs' \
    --userIDs 'UtNanddzgwxYdQc5' \
    > test.out 2>&1
eval_tap $? 13 'AdminQueryTicketDetail' test.out

#- 14 AdminTicketDetailGetByTicketID
$CLI_EXE \
    --sn sessionhistory \
    --op AdminTicketDetailGetByTicketID \
    --namespace $AB_NAMESPACE \
    --ticketId 'hEfefdopcEM0JHfo' \
    > test.out 2>&1
eval_tap $? 14 'AdminTicketDetailGetByTicketID' test.out

#- 15 PublicQueryGameSessionMe
$CLI_EXE \
    --sn sessionhistory \
    --op PublicQueryGameSessionMe \
    --namespace $AB_NAMESPACE \
    --limit '11' \
    --offset '49' \
    --order '2Hwi7vg3osbh0fL2' \
    > test.out 2>&1
eval_tap $? 15 'PublicQueryGameSessionMe' test.out

#- 16 QueryXrayMatchPool
$CLI_EXE \
    --sn sessionhistory \
    --op QueryXrayMatchPool \
    --namespace $AB_NAMESPACE \
    --poolName '["h7eJvAS2W4uqkhwS", "C7EajwHO3LfvwPew", "rf19Njm50xCDlPeN"]' \
    --endDate 'q0CvMXtyUWXrdZaF' \
    --startDate 'eacGT2x6o28Njxyw' \
    > test.out 2>&1
eval_tap $? 16 'QueryXrayMatchPool' test.out

#- 17 QueryDetailTickMatchPool
$CLI_EXE \
    --sn sessionhistory \
    --op QueryDetailTickMatchPool \
    --namespace $AB_NAMESPACE \
    --podName '7RHldq0m7NjUZ95Z' \
    --poolName '5XDLBN9YGVPtkjt0' \
    --all 'true' \
    --limit '50' \
    --offset '51' \
    --endDate 'BlJi4RbZ0Iy11mfO' \
    --startDate 'FjCzZVcGomWF1oAq' \
    > test.out 2>&1
eval_tap $? 17 'QueryDetailTickMatchPool' test.out

#- 18 QueryDetailTickMatchPoolMatches
$CLI_EXE \
    --sn sessionhistory \
    --op QueryDetailTickMatchPoolMatches \
    --namespace $AB_NAMESPACE \
    --podName 'UNFDtXnXLvOAsW8w' \
    --poolName 'Yh4gq7pRVZVLJiDx' \
    --tickId '3au9b9QjhzDlnJmi' \
    > test.out 2>&1
eval_tap $? 18 'QueryDetailTickMatchPoolMatches' test.out

#- 19 QueryDetailTickMatchPoolTicket
$CLI_EXE \
    --sn sessionhistory \
    --op QueryDetailTickMatchPoolTicket \
    --namespace $AB_NAMESPACE \
    --podName '4XaBTgoXjfdUQHa3' \
    --poolName 'RxspSqwdbTR2sgzf' \
    --tickId 'aQrUCW9fgo69uv1b' \
    > test.out 2>&1
eval_tap $? 19 'QueryDetailTickMatchPoolTicket' test.out

#- 20 QueryMatchHistories
$CLI_EXE \
    --sn sessionhistory \
    --op QueryMatchHistories \
    --matchId 'kFx8DmbC9UqYdYrd' \
    --namespace $AB_NAMESPACE \
    --limit '48' \
    --offset '31' \
    > test.out 2>&1
eval_tap $? 20 'QueryMatchHistories' test.out

#- 21 QueryMatchTicketHistories
$CLI_EXE \
    --sn sessionhistory \
    --op QueryMatchTicketHistories \
    --matchId 'NnuMcAwrSzYnrcet' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 21 'QueryMatchTicketHistories' test.out

#- 22 QueryXrayMatch
$CLI_EXE \
    --sn sessionhistory \
    --op QueryXrayMatch \
    --matchId 'xObeisZelKuD0iJ6' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 22 'QueryXrayMatch' test.out

#- 23 QueryAcquiringDS
$CLI_EXE \
    --sn sessionhistory \
    --op QueryAcquiringDS \
    --namespace $AB_NAMESPACE \
    --matchPool '["fs3zL9H4WxGWRH7f", "z4BdPhLtHRJOImSq", "37aeAaGq0NIj53gX"]' \
    --endDate 'kmrayvcIYiWxIAxf' \
    --startDate 'vLzSpDFY3lxe16Ks' \
    > test.out 2>&1
eval_tap $? 23 'QueryAcquiringDS' test.out

#- 24 QueryAcquiringDSWaitTimeAvg
$CLI_EXE \
    --sn sessionhistory \
    --op QueryAcquiringDSWaitTimeAvg \
    --namespace $AB_NAMESPACE \
    --matchPool '["SRzkf2HzBcEio5Uy", "vuFv5z6wosJGnUyC", "MEbHh1uE4DmJ4Suj"]' \
    --endDate '6DjUw36GtZ83Jp2f' \
    --startDate '9f1FCoIo3L24DKGw' \
    > test.out 2>&1
eval_tap $? 24 'QueryAcquiringDSWaitTimeAvg' test.out

#- 25 QueryMatchLengthDurationpAvg
$CLI_EXE \
    --sn sessionhistory \
    --op QueryMatchLengthDurationpAvg \
    --namespace $AB_NAMESPACE \
    --matchPool '["gZ85vyFJR8euQBLV", "u27iwplLJdzYS9K0", "VvwE6MAqPc8lGIYW"]' \
    --endDate 'TwxyqQQIXVmrtRlq' \
    --startDate '1jv60HTnmFrl3gYx' \
    > test.out 2>&1
eval_tap $? 25 'QueryMatchLengthDurationpAvg' test.out

#- 26 QueryMatchLengthDurationp99
$CLI_EXE \
    --sn sessionhistory \
    --op QueryMatchLengthDurationp99 \
    --namespace $AB_NAMESPACE \
    --matchPool '["6Xmv1DzPHux3k3sk", "hn3mWZjTYM95e4aa", "8xOJu7rNRVdygfKm"]' \
    --endDate 'Ukzj9mHFpff2vDkz' \
    --startDate '68zorEgcExv9nKMO' \
    > test.out 2>&1
eval_tap $? 26 'QueryMatchLengthDurationp99' test.out

#- 27 QueryTotalActiveSession
$CLI_EXE \
    --sn sessionhistory \
    --op QueryTotalActiveSession \
    --namespace $AB_NAMESPACE \
    --matchPool '["gO5W8SUaZjCpNtJS", "Mm8kDi3Rwubq7wtR", "GdT447Oa51m6VLfj"]' \
    --region 'sw270pMmOQJrpEBb' \
    --endDate 'VvBn8Lsf2qSAtizV' \
    --startDate '9hzsVbpJLtEZjuyF' \
    > test.out 2>&1
eval_tap $? 27 'QueryTotalActiveSession' test.out

#- 28 QueryTotalMatchmakingMatch
$CLI_EXE \
    --sn sessionhistory \
    --op QueryTotalMatchmakingMatch \
    --namespace $AB_NAMESPACE \
    --matchPool '["hvbxX2DNbknfVv4n", "m70TCayYAkF18YBw", "RxcREyU5CwqGJF6n"]' \
    --endDate 'Di33Iztr2QcwlRrR' \
    --startDate 'eRajlpk8lfuiJVck' \
    > test.out 2>&1
eval_tap $? 28 'QueryTotalMatchmakingMatch' test.out

#- 29 QueryTotalPlayerPersession
$CLI_EXE \
    --sn sessionhistory \
    --op QueryTotalPlayerPersession \
    --namespace $AB_NAMESPACE \
    --matchPool '["tlx9zJZVVCc9bpIH", "EWQMmCkIqwqpoTVC", "NrcaVozsjIXO2EUs"]' \
    --endDate 'AfBvo6Llcalks2R3' \
    --startDate 'VMtipTVxXAF8KhOK' \
    > test.out 2>&1
eval_tap $? 29 'QueryTotalPlayerPersession' test.out

#- 30 QueryTotalMatchmakingCanceled
$CLI_EXE \
    --sn sessionhistory \
    --op QueryTotalMatchmakingCanceled \
    --namespace $AB_NAMESPACE \
    --matchPool '["qbrECijFxOpOzxeT", "LJQsZcTEzXaXUzps", "AV6ct6XITL0QEkad"]' \
    --endDate 'MSQluAoED9oYwS8o' \
    --startDate 'LyErKvRtHFGJRoGW' \
    > test.out 2>&1
eval_tap $? 30 'QueryTotalMatchmakingCanceled' test.out

#- 31 QueryTotalMatchmakingCreated
$CLI_EXE \
    --sn sessionhistory \
    --op QueryTotalMatchmakingCreated \
    --namespace $AB_NAMESPACE \
    --matchPool '["7VBG1VB2sp2x9msz", "GGoyhGZAzt2OVBTL", "wSH8hWRU9pbItGQ7"]' \
    --endDate 'VUWBhGolwafIfbF1' \
    --startDate 'GLFnrQ4T5cmw7U1T' \
    > test.out 2>&1
eval_tap $? 31 'QueryTotalMatchmakingCreated' test.out

#- 32 QueryTotalMatchmakingExpired
$CLI_EXE \
    --sn sessionhistory \
    --op QueryTotalMatchmakingExpired \
    --namespace $AB_NAMESPACE \
    --matchPool '["xiS06UEoaDZpXOWz", "pXOi2cpajtqcXjPk", "j2IzU3MEpCt1Ijlf"]' \
    --endDate 'HJM92t9j1XT2ErwI' \
    --startDate 'xkaTnYtr1YDnaXB0' \
    > test.out 2>&1
eval_tap $? 32 'QueryTotalMatchmakingExpired' test.out

#- 33 QueryTotalMatchmakingMatchTicket
$CLI_EXE \
    --sn sessionhistory \
    --op QueryTotalMatchmakingMatchTicket \
    --namespace $AB_NAMESPACE \
    --matchPool '["JOS4XKVT66sHYPgV", "sfhoEidKw4IP0NVn", "aangorhVFpTRuQyM"]' \
    --endDate 'roT2hNfKJ7q8sifS' \
    --startDate 'PmYSsBxtyKWssEn5' \
    > test.out 2>&1
eval_tap $? 33 'QueryTotalMatchmakingMatchTicket' test.out

#- 34 CreateXrayTicketObservability
# body param: body
echo '{"action": "VEvIMEB4pl506fLC", "activeAllianceRule": {"max_number": 66, "min_number": 3, "player_max_number": 23, "player_min_number": 62}, "activeMatchingRule": [{"attribute": "vnfNiABRf1gdXM7Q", "criteria": "lAlnjAfgxOdZdf9t", "reference": 0.6095866669301306}, {"attribute": "HO1qrNyhmUEADczz", "criteria": "rL31HuYKsCBBgwb1", "reference": 0.1237534696372321}, {"attribute": "GjHJgxrcEvnfJqU4", "criteria": "hCv5egSQDePKSZKp", "reference": 0.949101342784212}], "function": "zwDQS1atvJrALaip", "gameMode": "lJgRhedl5Ewh3jDa", "isBackfillMatch": true, "isRuleSetFlexed": false, "iteration": 69, "matchID": "StUiBB1yz3iP8gH8", "namespace": "8UenlMVzIOP8NOf9", "remainingPlayersPerTicket": [92, 77, 71], "remainingTickets": 38, "sessionTickID": "2IFcRwSoMTuJziuD", "tickID": 81, "ticketID": "IapYftYZkBXiEhdi", "timeToMatchSec": 0.7135579670408009, "timestamp": "1994-06-11T00:00:00Z", "unbackfillReason": "VBAEUvoBlbH02bob", "unmatchReason": "xtljIfHBgjP9onbx"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op CreateXrayTicketObservability \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 34 'CreateXrayTicketObservability' test.out

#- 35 CreateXrayBulkTicketObservability
# body param: body
echo '{"ticketObservabilities": [{"action": "FcxS2OZZfXO3HkJT", "activeAllianceRule": {"max_number": 83, "min_number": 86, "player_max_number": 38, "player_min_number": 6}, "activeMatchingRule": [{"attribute": "AopmjI7CbY2WuwRU", "criteria": "T9IivgC4mJ5OHuNE", "reference": 0.7621623430243994}, {"attribute": "QK4Mvk00I9GqAhhj", "criteria": "NIivdIcaEQfNETQC", "reference": 0.4439608579922527}, {"attribute": "PK1mYwKVQoydbYjX", "criteria": "ZyBpqhCJBtFOm3iC", "reference": 0.24236125557556087}], "function": "u0lhhgutt3rQuKP1", "gameMode": "OEtKFBjNihHU8GP8", "isBackfillMatch": true, "isRuleSetFlexed": false, "iteration": 23, "matchID": "SvYXKz4BGjbsrRBV", "namespace": "8aztJ86yQK1AsC18", "remainingPlayersPerTicket": [95, 27, 82], "remainingTickets": 73, "sessionTickID": "6JcXmwQfkseTpH6l", "tickID": 77, "ticketID": "Dv8SvqYKc56PcPSL", "timeToMatchSec": 0.879251083967181, "timestamp": "1982-08-23T00:00:00Z", "unbackfillReason": "mjViKkKw4gHA4CaL", "unmatchReason": "sPqRsTdKzcKtkGcv"}, {"action": "n44NWse6VLPkM1VT", "activeAllianceRule": {"max_number": 36, "min_number": 87, "player_max_number": 95, "player_min_number": 57}, "activeMatchingRule": [{"attribute": "nQmZqX15hBb4dlNT", "criteria": "IBDtHunwNLLfKCQK", "reference": 0.3311087593125619}, {"attribute": "u2MWXpEpNjHWPcFS", "criteria": "nM7GAvk19sXDish7", "reference": 0.5885329330507895}, {"attribute": "UVhmAwmAygsnn8pM", "criteria": "7l6v0elLMceGGgb5", "reference": 0.5131160022466256}], "function": "JHWE6s13b7dmnPij", "gameMode": "w6U8GGp0E886E90E", "isBackfillMatch": true, "isRuleSetFlexed": false, "iteration": 16, "matchID": "oiXT1Uy0gArtDpQE", "namespace": "4bOtoiAjHXcVVOsV", "remainingPlayersPerTicket": [50, 55, 46], "remainingTickets": 31, "sessionTickID": "U6uisejapftqoxuj", "tickID": 93, "ticketID": "DosOo2kSUfIA1guT", "timeToMatchSec": 0.6385159946648434, "timestamp": "1983-06-15T00:00:00Z", "unbackfillReason": "7haejXSV2oH2uH8S", "unmatchReason": "4Zx0ACteueMOmYP4"}, {"action": "SgxAIQTTKsdmtHu1", "activeAllianceRule": {"max_number": 6, "min_number": 89, "player_max_number": 67, "player_min_number": 66}, "activeMatchingRule": [{"attribute": "0us7kIWLcgKgU940", "criteria": "6tdRDqr3cpVbaH69", "reference": 0.6345003159653746}, {"attribute": "yTfGE59942bCwgpz", "criteria": "UfcmTQjRmV0CPt1L", "reference": 0.7514359350487222}, {"attribute": "aTvrFaxzOfG3pTdd", "criteria": "IA0Rt6wM5oQvTMIC", "reference": 0.3198279720243198}], "function": "WyUtVDnhgTGXO8Ut", "gameMode": "pwxug8MpqczRvUdK", "isBackfillMatch": false, "isRuleSetFlexed": true, "iteration": 48, "matchID": "OV1ZJTYuHpnpVX5u", "namespace": "4gw4XBXDD7BG73sD", "remainingPlayersPerTicket": [7, 35, 61], "remainingTickets": 16, "sessionTickID": "oXnB8F5X05KUgGKf", "tickID": 61, "ticketID": "OwODWBAz6skHMfl4", "timeToMatchSec": 0.5394668631259848, "timestamp": "1975-07-03T00:00:00Z", "unbackfillReason": "wqpnMdSNskxhl3O3", "unmatchReason": "kGloooh7kL598P7F"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op CreateXrayBulkTicketObservability \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 35 'CreateXrayBulkTicketObservability' test.out

#- 36 QueryXrayTimelineByTicketID
$CLI_EXE \
    --sn sessionhistory \
    --op QueryXrayTimelineByTicketID \
    --namespace $AB_NAMESPACE \
    --ticketId '3IKhiNdx1V7199NT' \
    --limit '34' \
    --offset '73' \
    --endDate 'tvSR9q6l5k9BLQMr' \
    --startDate 'PoTuxdzEYAw5VdW0' \
    > test.out 2>&1
eval_tap $? 36 'QueryXrayTimelineByTicketID' test.out

#- 37 QueryXrayTimelineByUserID
$CLI_EXE \
    --sn sessionhistory \
    --op QueryXrayTimelineByUserID \
    --namespace $AB_NAMESPACE \
    --userId '5WnQEAbK416LN2N6' \
    --limit '60' \
    --offset '95' \
    --endDate '6yczitn4OkZfx0Xa' \
    --startDate '6sgegAWYz2z4qSPP' \
    > test.out 2>&1
eval_tap $? 37 'QueryXrayTimelineByUserID' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE