#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 512
# - template file: cli-test.j2

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..30"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '69' \
    --offset '13' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"deployment": "5PP3YBSr", "description": "ZVvmM56G", "find_match_timeout_seconds": 36, "game_mode": "Hr9wbaxq", "joinable": true, "max_delay_ms": 28, "rule_set": {"alliance": {"max_number": 31, "min_number": 92, "player_max_number": 86, "player_min_number": 32}, "alliance_flexing_rule": [{"duration": 45, "max_number": 16, "min_number": 97, "player_max_number": 81, "player_min_number": 8}, {"duration": 51, "max_number": 42, "min_number": 43, "player_max_number": 17, "player_min_number": 68}, {"duration": 65, "max_number": 82, "min_number": 13, "player_max_number": 76, "player_min_number": 41}], "flexing_rule": [{"attribute": "oCA5LQTL", "criteria": "QdjbFdBq", "duration": 79, "reference": 0.7042895308278039}, {"attribute": "Evvo3xvK", "criteria": "hR6mkQFO", "duration": 50, "reference": 0.024059726753204336}, {"attribute": "vPPyaUCh", "criteria": "hf7Y6tDc", "duration": 57, "reference": 0.47090477741785686}], "match_options": {"options": [{"name": "J3gZadAu", "type": "wswQpPok"}, {"name": "0lx2OL5G", "type": "8OADfQlq"}, {"name": "vpmcY90W", "type": "OKrEYMP2"}]}, "matching_rule": [{"attribute": "Tt3efzKI", "criteria": "EbrWKZut", "reference": 0.1711723856866062}, {"attribute": "Y31r7GlJ", "criteria": "XFrgahWJ", "reference": 0.3750214191858069}, {"attribute": "TQLKkYHA", "criteria": "xNn0ccPs", "reference": 0.24454343956493574}], "sub_game_modes": {"6i1UkJIE": {"alliance": {"max_number": 53, "min_number": 48, "player_max_number": 34, "player_min_number": 97}, "alliance_flexing_rule": [{"duration": 34, "max_number": 51, "min_number": 61, "player_max_number": 71, "player_min_number": 50}, {"duration": 3, "max_number": 9, "min_number": 32, "player_max_number": 0, "player_min_number": 13}, {"duration": 82, "max_number": 41, "min_number": 3, "player_max_number": 58, "player_min_number": 13}], "name": "5Nr85J2a"}, "vVP505oe": {"alliance": {"max_number": 11, "min_number": 32, "player_max_number": 95, "player_min_number": 50}, "alliance_flexing_rule": [{"duration": 26, "max_number": 17, "min_number": 43, "player_max_number": 35, "player_min_number": 56}, {"duration": 100, "max_number": 96, "min_number": 98, "player_max_number": 60, "player_min_number": 83}, {"duration": 83, "max_number": 27, "min_number": 61, "player_max_number": 32, "player_min_number": 25}], "name": "aUfkSMTz"}, "13M3xH3n": {"alliance": {"max_number": 100, "min_number": 67, "player_max_number": 4, "player_min_number": 63}, "alliance_flexing_rule": [{"duration": 63, "max_number": 60, "min_number": 88, "player_max_number": 9, "player_min_number": 55}, {"duration": 16, "max_number": 77, "min_number": 41, "player_max_number": 3, "player_min_number": 37}, {"duration": 73, "max_number": 36, "min_number": 59, "player_max_number": 20, "player_min_number": 35}], "name": "2Acl2l8f"}}}, "session_queue_timeout_seconds": 65, "social_matchmaking": true, "use_sub_gamemode": true}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel 'X2OOWGY3' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'DeleteChannelHandler' test.out

#- 7 StoreMatchResults
# body param: body
echo '{"match_id": "7fSIc4ZJ", "players": [{"results": [{"attribute": "RseMOfNZ", "value": 0.8673085593402611}, {"attribute": "b5SOkwFx", "value": 0.9314057523902682}, {"attribute": "6gl92V6S", "value": 0.5761625699004113}], "user_id": "lPhJZvzM"}, {"results": [{"attribute": "x4wd3BaK", "value": 0.010177599225892897}, {"attribute": "9PRkTqLB", "value": 0.006353594273557195}, {"attribute": "lCbRNEnj", "value": 0.791375854656019}], "user_id": "w5FWbz3M"}, {"results": [{"attribute": "wvPfwDNo", "value": 0.8137589645733271}, {"attribute": "kQVHzhJW", "value": 0.24806598367135457}, {"attribute": "TbDvfXAK", "value": 0.3591954669159121}], "user_id": "aDHY2fRu"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 7 'StoreMatchResults' test.out

#- 8 Rebalance
# body param: body
echo '{"match_id": "1Kssq4wa"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'Rebalance' test.out

#- 9 QueueSessionHandler
# body param: body
echo '{"channel": "LsOkChXS", "client_version": "6SXOIG57", "deployment": "Z2Wj3V3E", "game_mode": "HSSiTqXw", "joinable": true, "match_id": "jxPudvfG", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 36, "party_attributes": {"R8GDGQPG": {}, "mxJwQcht": {}, "ga4qV0nY": {}}, "party_id": "KLG6QJ30", "party_members": [{"extra_attributes": {"VD9THho5": {}, "uHIUGtK0": {}, "nx8nYZKu": {}}, "user_id": "vCtAg03o"}, {"extra_attributes": {"8PdeSUqx": {}, "8TcxO4lV": {}, "hgTed3Wa": {}}, "user_id": "I5S9NXBO"}, {"extra_attributes": {"86jvT90s": {}, "2ZZv2MBb": {}, "F6Ju8p8W": {}}, "user_id": "GsH3oWZP"}]}, {"first_ticket_created_at": 3, "party_attributes": {"h6YOY71a": {}, "ZJGpqSzm": {}, "4xn9EzBr": {}}, "party_id": "5gKkX4mp", "party_members": [{"extra_attributes": {"VqmPbyUk": {}, "3L7Gheje": {}, "MK0UlAlk": {}}, "user_id": "961UNkjy"}, {"extra_attributes": {"Vh3otlms": {}, "mV2eCZrN": {}, "lzAhHOeg": {}}, "user_id": "NdiYA2TP"}, {"extra_attributes": {"Ku6m1ByZ": {}, "HemrnYSt": {}, "IxSkDH1B": {}}, "user_id": "vuHVrfxz"}]}, {"first_ticket_created_at": 52, "party_attributes": {"TUe5yNIX": {}, "RjrLApjX": {}, "5amoGdyL": {}}, "party_id": "xFAGxASk", "party_members": [{"extra_attributes": {"fCrA0IUW": {}, "a6wuDQ7B": {}, "CcR2gd9x": {}}, "user_id": "jI8EYCly"}, {"extra_attributes": {"463UpFZA": {}, "oHgoEnFv": {}, "D1ZZR5Ky": {}}, "user_id": "wJYm7gkg"}, {"extra_attributes": {"D9Tk7lKc": {}, "RrEn1iII": {}, "OpaB1TiI": {}}, "user_id": "2vx7kd9R"}]}]}, {"matching_parties": [{"first_ticket_created_at": 49, "party_attributes": {"3XmEksYL": {}, "MGVpW8HX": {}, "WIGHqVJH": {}}, "party_id": "TLbuYegS", "party_members": [{"extra_attributes": {"Ecn5QDJl": {}, "SB7woa07": {}, "yzXCakAS": {}}, "user_id": "ujwZbV7x"}, {"extra_attributes": {"pevz2Hfn": {}, "KgH6RNU1": {}, "OMXTLS9s": {}}, "user_id": "HaBnVAu1"}, {"extra_attributes": {"lqp1oF4q": {}, "QUETEHRd": {}, "eLIJqgXZ": {}}, "user_id": "EEn41INI"}]}, {"first_ticket_created_at": 41, "party_attributes": {"RyNf6J0p": {}, "pPDZk5DQ": {}, "BrCnnpom": {}}, "party_id": "5VwvGSqW", "party_members": [{"extra_attributes": {"NHYdm2BM": {}, "3LX71RsH": {}, "NoRij1N2": {}}, "user_id": "GQ5dFMuz"}, {"extra_attributes": {"D9gZm5Ej": {}, "n0AlqD2L": {}, "ZzYY3S6X": {}}, "user_id": "ye6P8HqW"}, {"extra_attributes": {"O3L1tAAe": {}, "i4q7KXm2": {}, "JFIZmmAt": {}}, "user_id": "bgBfVrTX"}]}, {"first_ticket_created_at": 97, "party_attributes": {"3OToIy2Z": {}, "G6XJimT6": {}, "6A7AfzGG": {}}, "party_id": "0Ef1KwTl", "party_members": [{"extra_attributes": {"daEqg6zJ": {}, "93IpcD8F": {}, "OBOcts4z": {}}, "user_id": "yAdll7F6"}, {"extra_attributes": {"Rt0wa1WJ": {}, "g15NkEoF": {}, "mnGuFIYr": {}}, "user_id": "eJeHMnPI"}, {"extra_attributes": {"9He0U7UY": {}, "7FTB8MZ9": {}, "C38mkLBp": {}}, "user_id": "dpONLPzF"}]}]}, {"matching_parties": [{"first_ticket_created_at": 15, "party_attributes": {"ryYYh7zk": {}, "xChaZEqg": {}, "tdxWyuSX": {}}, "party_id": "pbeh9NfZ", "party_members": [{"extra_attributes": {"t1PJNofz": {}, "ryeFl5He": {}, "f3mAaolH": {}}, "user_id": "bEtY2Zty"}, {"extra_attributes": {"UihP6Vve": {}, "J6zjIJlu": {}, "9BX9TWIj": {}}, "user_id": "in9flQBL"}, {"extra_attributes": {"OhH1mG02": {}, "r1cClvOa": {}, "u43VpR4H": {}}, "user_id": "YKHHC8Do"}]}, {"first_ticket_created_at": 30, "party_attributes": {"3G0ZgwtA": {}, "beZVBpsf": {}, "NU2pPbte": {}}, "party_id": "QTJG94fp", "party_members": [{"extra_attributes": {"o0uQrS6R": {}, "vIXKa09p": {}, "9jVunjPd": {}}, "user_id": "63lFl2cK"}, {"extra_attributes": {"vZzIqtB6": {}, "IhRkuAVZ": {}, "gLoKT0lu": {}}, "user_id": "tJU40KP7"}, {"extra_attributes": {"PVlBGiHV": {}, "PO2Ol7bD": {}, "uVrj91jj": {}}, "user_id": "zOVS4qKX"}]}, {"first_ticket_created_at": 40, "party_attributes": {"nWG6M0Px": {}, "8cr49SwL": {}, "j7ybc7Dc": {}}, "party_id": "GgnXR0kX", "party_members": [{"extra_attributes": {"L0KYXTvC": {}, "HpR165Sb": {}, "RVMya238": {}}, "user_id": "4Da6OMJT"}, {"extra_attributes": {"1VAXGnwS": {}, "UU7ndS1s": {}, "0S5kCHPN": {}}, "user_id": "NJSbID6h"}, {"extra_attributes": {"XfPcnrxr": {}, "QOkxHd05": {}, "WQVslRZm": {}}, "user_id": "rWwB0SZw"}]}]}], "namespace": "Q5JbHKL2", "party_attributes": {"jQ8Be12k": {}, "4ux01dlx": {}, "aQGtYUye": {}}, "party_id": "aMRKwAJO", "queued_at": 1, "region": "dWBSF9Ax", "server_name": "JMN4WDmR", "status": "qNGTOGUe", "updated_at": "1999-07-12T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'QueueSessionHandler' test.out

#- 10 DequeueSessionHandler
# body param: body
echo '{"match_id": "MqaEvK6c"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'DequeueSessionHandler' test.out

#- 11 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'mS8DwNaf' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 11 'QuerySessionHandler' test.out

#- 12 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 26, "userID": "LJXBsIFZ", "weight": 0.3027036894191719}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 12 'UpdatePlayTimeWeight' test.out

#- 13 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 13 'GetAllPartyInAllChannel' test.out

#- 14 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs 'h0RUicap' \
    > test.out 2>&1
eval_tap $? 14 'BulkGetSessions' test.out

#- 15 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 15 'ExportChannels' test.out

#- 16 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload $TEMP_FILE_UPLOAD \
    --strategy 'k0BwWXoN' \
    > test.out 2>&1
eval_tap $? 16 'ImportChannels' test.out

#- 17 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName 'H7PelKON' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 17 'GetSingleMatchmakingChannel' test.out

#- 18 UpdateMatchmakingChannel
# body param: body
echo '{"deployment": "73OSoGFL", "description": "mAtO6Cj4", "findMatchTimeoutSeconds": 100, "joinable": true, "max_delay_ms": 80, "ruleSet": {"alliance": {"maxNumber": 50, "minNumber": 26, "playerMaxNumber": 90, "playerMinNumber": 55}, "alliance_flexing_rule": [{"duration": 17, "max_number": 61, "min_number": 31, "player_max_number": 18, "player_min_number": 33}, {"duration": 98, "max_number": 93, "min_number": 15, "player_max_number": 91, "player_min_number": 94}, {"duration": 9, "max_number": 6, "min_number": 26, "player_max_number": 6, "player_min_number": 100}], "flexingRules": [{"attribute": "Knq8rtXk", "criteria": "Cu4WQMid", "duration": 25, "reference": 0.1696778907754033}, {"attribute": "BJDk2wAH", "criteria": "tPpixkUz", "duration": 62, "reference": 0.15285146810850914}, {"attribute": "J8h1jEGZ", "criteria": "kjdgPqAx", "duration": 3, "reference": 0.8421162234975513}], "match_options": {"options": [{"name": "bIURqC6o", "type": "tg8KFTbf"}, {"name": "zL71rwwF", "type": "0uOXXG2I"}, {"name": "A4rbzF0c", "type": "zbusAcqv"}]}, "matchingRules": [{"attribute": "lgi2zvjz", "criteria": "9ooIhR7u", "reference": 0.05476695451406188}, {"attribute": "rMyyttju", "criteria": "F8fRPsx3", "reference": 0.450893464378713}, {"attribute": "BDhxMeZz", "criteria": "B5mKbk0P", "reference": 0.97357210298889}], "sub_game_modes": {}}, "sessionQueueTimeoutSeconds": 54, "socialMatchmaking": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName 'beyfwe37' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 18 'UpdateMatchmakingChannel' test.out

#- 19 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName '6Ng0AFkd' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 19 'GetAllPartyInChannel' test.out

#- 20 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName '3BisdcLT' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'GetAllSessionsInChannel' test.out

#- 21 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["gVn8QzRZ", "Q2Cu3LPM", "jRMvkzJg"], "party_id": "KpllbDOp", "user_id": "VmsqJwTl"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName 'uEvZRrGY' \
    --matchID 'Z5mVXJWB' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 21 'AddUserIntoSessionInChannel' test.out

#- 22 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName 'duhwnZNC' \
    --matchID 'PLMeihGk' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 22 'DeleteSessionInChannel' test.out

#- 23 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName 'oUBQyirY' \
    --matchID 'GOp4j0YV' \
    --namespace $AB_NAMESPACE \
    --userID '73GTIsv4' \
    > test.out 2>&1
eval_tap $? 23 'DeleteUserFromSessionInChannel' test.out

#- 24 SearchSessions
$CLI_EXE \
    --sn matchmaking \
    --op SearchSessions \
    --namespace $AB_NAMESPACE \
    --channel 'QVrdrV4x' \
    --deleted 'false' \
    --matchID 'bAg5rtaZ' \
    --partyID '7xWaAHrW' \
    --userID 'fp3TGgyF' \
    --limit '13' \
    --offset '89' \
    > test.out 2>&1
eval_tap $? 24 'SearchSessions' test.out

#- 25 GetSessionHistoryDetailed
$CLI_EXE \
    --sn matchmaking \
    --op GetSessionHistoryDetailed \
    --matchID 'OBmWLRSy' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 25 'GetSessionHistoryDetailed' test.out

#- 26 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 26 'PublicGetMessages' test.out

#- 27 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'PublicGetAllMatchmakingChannel' test.out

#- 28 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName '1HV8NH51' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'PublicGetSingleMatchmakingChannel' test.out

#- 29 SearchSessionsV2
$CLI_EXE \
    --sn matchmaking \
    --op SearchSessionsV2 \
    --namespace $AB_NAMESPACE \
    --channel 'WHRZOBsI' \
    --deleted 'false' \
    --matchID '5YX9SlMG' \
    --partyID 'RcZOFJ4X' \
    --userID 'z5gtzYUn' \
    --limit '92' \
    --offset '37' \
    > test.out 2>&1
eval_tap $? 29 'SearchSessionsV2' test.out

#- 30 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 30 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE