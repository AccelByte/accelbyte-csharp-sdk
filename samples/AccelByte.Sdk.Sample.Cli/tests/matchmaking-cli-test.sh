#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 512
# - template file: cli-test.j2

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..30"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '4' \
    --offset '48' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"deployment": "NkiOlqVa", "description": "rRM0U1X2", "find_match_timeout_seconds": 89, "game_mode": "32n6C27c", "joinable": true, "max_delay_ms": 51, "rule_set": {"alliance": {"max_number": 53, "min_number": 13, "player_max_number": 28, "player_min_number": 81}, "alliance_flexing_rule": [{"duration": 17, "max_number": 37, "min_number": 74, "player_max_number": 75, "player_min_number": 22}, {"duration": 87, "max_number": 20, "min_number": 65, "player_max_number": 11, "player_min_number": 85}, {"duration": 40, "max_number": 7, "min_number": 91, "player_max_number": 91, "player_min_number": 50}], "flexing_rule": [{"attribute": "3wxqi0Dw", "criteria": "GvhemdT2", "duration": 72, "reference": 0.028715591299155352}, {"attribute": "tr7YQPN4", "criteria": "tLS5BtT1", "duration": 31, "reference": 0.4585715688643365}, {"attribute": "ptnW7b6F", "criteria": "BIcKuqts", "duration": 82, "reference": 0.7308976782203371}], "match_options": {"options": [{"name": "74kBVpYb", "type": "WMjj1hKz"}, {"name": "BJRTxSxU", "type": "KoVke3R2"}, {"name": "iJkpgQw8", "type": "UOVB1tUH"}]}, "matching_rule": [{"attribute": "8tEqNiV3", "criteria": "dt4pPwmV", "reference": 0.46003037744359065}, {"attribute": "FfndI0yR", "criteria": "oYTF7UUX", "reference": 0.047505468221857416}, {"attribute": "ZcnUWfa0", "criteria": "iLrV8rkk", "reference": 0.8594632919193473}], "sub_game_modes": {"ajXSnD5W": {"alliance": {"max_number": 50, "min_number": 39, "player_max_number": 29, "player_min_number": 8}, "alliance_flexing_rule": [{"duration": 67, "max_number": 80, "min_number": 70, "player_max_number": 63, "player_min_number": 93}, {"duration": 89, "max_number": 33, "min_number": 92, "player_max_number": 33, "player_min_number": 43}, {"duration": 41, "max_number": 87, "min_number": 87, "player_max_number": 58, "player_min_number": 44}], "name": "XBwPqYzR"}, "QSjty5TL": {"alliance": {"max_number": 58, "min_number": 40, "player_max_number": 5, "player_min_number": 20}, "alliance_flexing_rule": [{"duration": 70, "max_number": 57, "min_number": 33, "player_max_number": 95, "player_min_number": 6}, {"duration": 82, "max_number": 67, "min_number": 2, "player_max_number": 85, "player_min_number": 86}, {"duration": 17, "max_number": 53, "min_number": 97, "player_max_number": 81, "player_min_number": 86}], "name": "Tk2BOExH"}, "CzKqafjz": {"alliance": {"max_number": 4, "min_number": 27, "player_max_number": 89, "player_min_number": 7}, "alliance_flexing_rule": [{"duration": 9, "max_number": 10, "min_number": 86, "player_max_number": 94, "player_min_number": 57}, {"duration": 90, "max_number": 25, "min_number": 90, "player_max_number": 100, "player_min_number": 11}, {"duration": 41, "max_number": 74, "min_number": 30, "player_max_number": 25, "player_min_number": 73}], "name": "qHXeZY6s"}}}, "session_queue_timeout_seconds": 12, "social_matchmaking": true, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel '86wAZrq4' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'DeleteChannelHandler' test.out

#- 7 StoreMatchResults
# body param: body
echo '{"match_id": "dFkypioQ", "players": [{"results": [{"attribute": "1g7SOt0m", "value": 0.9057487040549251}, {"attribute": "72D8wDcu", "value": 0.9043083924493692}, {"attribute": "jBY4xBrW", "value": 0.5020122494853505}], "user_id": "XgC2AS8d"}, {"results": [{"attribute": "0mGxj0bb", "value": 0.8698104529802755}, {"attribute": "tNoTRIoP", "value": 0.5439230284413771}, {"attribute": "08rduw2z", "value": 0.5657483585696618}], "user_id": "28Fg67dy"}, {"results": [{"attribute": "jvU673xl", "value": 0.4284016992742964}, {"attribute": "fsmGXLbJ", "value": 0.04732133095550284}, {"attribute": "vTC4j7fy", "value": 0.7685242354921497}], "user_id": "r5yyjsJr"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 7 'StoreMatchResults' test.out

#- 8 Rebalance
# body param: body
echo '{"match_id": "CDfhyz9K"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'Rebalance' test.out

#- 9 QueueSessionHandler
# body param: body
echo '{"channel": "VnU0VcVQ", "client_version": "qacGVteJ", "deployment": "by5Tp7TH", "game_mode": "BZpFAS4L", "joinable": true, "match_id": "filjTJQm", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 13, "party_attributes": {"tc3ifZt3": {}, "OEB7qrAg": {}, "IhBOOA3W": {}}, "party_id": "K5hl5dXb", "party_members": [{"extra_attributes": {"jdXILoMJ": {}, "pBMNefqe": {}, "WIToATKi": {}}, "user_id": "MeHJoeEf"}, {"extra_attributes": {"9lCUthET": {}, "52Iepu9N": {}, "Xs4CODQ4": {}}, "user_id": "rDDelgbB"}, {"extra_attributes": {"0wE1ZWF1": {}, "s6d9qzpy": {}, "CHT2adn9": {}}, "user_id": "Zjm2usqd"}]}, {"first_ticket_created_at": 43, "party_attributes": {"OnoGGnDJ": {}, "5Pw5vPAs": {}, "sMOXyLcS": {}}, "party_id": "8idoQNPR", "party_members": [{"extra_attributes": {"ke228o8k": {}, "sj7tvh2K": {}, "jBTM36t2": {}}, "user_id": "hbLvRQXh"}, {"extra_attributes": {"ZJHGvc9d": {}, "Ou1ik1Xq": {}, "7XTcvmvS": {}}, "user_id": "8BWGegcj"}, {"extra_attributes": {"72K6oc5d": {}, "eEO2NXU8": {}, "m7X1aVYh": {}}, "user_id": "TK1XNlo7"}]}, {"first_ticket_created_at": 91, "party_attributes": {"psvZjOpr": {}, "HAV14ion": {}, "Q5J2JYUL": {}}, "party_id": "PVYYerNN", "party_members": [{"extra_attributes": {"UGcF9NOz": {}, "V6RLXMUy": {}, "vs4BDaoA": {}}, "user_id": "xkEAnbxm"}, {"extra_attributes": {"utj1KpNP": {}, "qxHjXQ06": {}, "90sjOhtg": {}}, "user_id": "e51U5y40"}, {"extra_attributes": {"2jENiGvS": {}, "ZtzJna6L": {}, "BFu5ZcOW": {}}, "user_id": "btYqoqPQ"}]}]}, {"matching_parties": [{"first_ticket_created_at": 26, "party_attributes": {"qJAyTafp": {}, "irbHFSso": {}, "BbejTt3O": {}}, "party_id": "feb22FI6", "party_members": [{"extra_attributes": {"gWm8z9oW": {}, "9igw3Aae": {}, "7nWSVtcZ": {}}, "user_id": "rMiV82XE"}, {"extra_attributes": {"iptBMGbG": {}, "8YK8J6qb": {}, "tAF4cE7l": {}}, "user_id": "olZXBSnn"}, {"extra_attributes": {"muF8M2Tg": {}, "TjFgFVtf": {}, "pDzY92kv": {}}, "user_id": "pFwUGkqu"}]}, {"first_ticket_created_at": 34, "party_attributes": {"jIn8GFFT": {}, "Z6slJuv4": {}, "cNI1tDI6": {}}, "party_id": "zdIwtkyx", "party_members": [{"extra_attributes": {"3zjiCHxi": {}, "CvdJxll6": {}, "eh97FV3c": {}}, "user_id": "Z276NBDP"}, {"extra_attributes": {"9TU9WA5V": {}, "b6AsbSdg": {}, "kcFZTXpM": {}}, "user_id": "GKOxA8iV"}, {"extra_attributes": {"4dJIEw7q": {}, "fKeeJlVq": {}, "QFTa18Wz": {}}, "user_id": "poq0y2TD"}]}, {"first_ticket_created_at": 18, "party_attributes": {"IEnEBSTt": {}, "QcWqfbJB": {}, "sYuCy3AF": {}}, "party_id": "iGQBweZr", "party_members": [{"extra_attributes": {"Q83voQuK": {}, "38pPlk6k": {}, "mH6xkTk5": {}}, "user_id": "PiLfP2Xw"}, {"extra_attributes": {"8ynO92eE": {}, "h662RMPM": {}, "O1vcE9od": {}}, "user_id": "esJ7xkFm"}, {"extra_attributes": {"vxgZFxCP": {}, "6koqHKsw": {}, "7j1VZhyf": {}}, "user_id": "18mwYTDY"}]}]}, {"matching_parties": [{"first_ticket_created_at": 20, "party_attributes": {"A471j5no": {}, "GBPpSsNF": {}, "piqtc13k": {}}, "party_id": "kZyeSx6x", "party_members": [{"extra_attributes": {"YSUPVLWW": {}, "ubMZpLAO": {}, "hcLuBCwX": {}}, "user_id": "Ix4jwCr5"}, {"extra_attributes": {"JEt4rwUx": {}, "LIsiKuNb": {}, "SNkM6PEa": {}}, "user_id": "bs9aWaWM"}, {"extra_attributes": {"A6tasY8g": {}, "QuLlDI4P": {}, "WtQty09f": {}}, "user_id": "j0420IAn"}]}, {"first_ticket_created_at": 76, "party_attributes": {"fhw0bDOV": {}, "QM92in9n": {}, "yETwPp4o": {}}, "party_id": "D6yi1t1u", "party_members": [{"extra_attributes": {"RdY823Rk": {}, "LEag4H8D": {}, "HIh7rrrb": {}}, "user_id": "ofc4khQr"}, {"extra_attributes": {"pHfHK3Dh": {}, "LlSQhQW2": {}, "8ZN5D4ch": {}}, "user_id": "qP39N0wY"}, {"extra_attributes": {"KlNasJcg": {}, "aY1Q3yRF": {}, "cpQsbb0K": {}}, "user_id": "awFhRL0O"}]}, {"first_ticket_created_at": 52, "party_attributes": {"Nl4O1LaO": {}, "aNuPhwBK": {}, "344zou3l": {}}, "party_id": "pdEmJad3", "party_members": [{"extra_attributes": {"p88e2ir2": {}, "Y5rCBVmq": {}, "vYHnu3mV": {}}, "user_id": "TIBbIVR6"}, {"extra_attributes": {"bDKWSu90": {}, "XorAsyEU": {}, "nnoo0O8e": {}}, "user_id": "26RA8i4C"}, {"extra_attributes": {"4bCIQTPd": {}, "79SdYePp": {}, "RaCEAZyO": {}}, "user_id": "vukwppbu"}]}]}], "namespace": "LlwmlJAV", "party_attributes": {"TQjPaSB3": {}, "jcsqTGdr": {}, "9n6vDFfj": {}}, "party_id": "1wHwp734", "queued_at": 70, "region": "oN1NdI6r", "server_name": "hPdQGr39", "status": "lf7FLCse", "updated_at": "1988-02-05T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'QueueSessionHandler' test.out

#- 10 DequeueSessionHandler
# body param: body
echo '{"match_id": "nzO5H1AM"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'DequeueSessionHandler' test.out

#- 11 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'pup8GTBP' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 11 'QuerySessionHandler' test.out

#- 12 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 44, "userID": "yQIu6ayX", "weight": 0.07919350400679226}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 12 'UpdatePlayTimeWeight' test.out

#- 13 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 13 'GetAllPartyInAllChannel' test.out

#- 14 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs 'bIpv4TFK' \
    > test.out 2>&1
eval_tap $? 14 'BulkGetSessions' test.out

#- 15 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 15 'ExportChannels' test.out

#- 16 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload $TEMP_FILE_UPLOAD \
    --strategy 'KAtzP9rP' \
    > test.out 2>&1
eval_tap $? 16 'ImportChannels' test.out

#- 17 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName '0ycPDdgO' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 17 'GetSingleMatchmakingChannel' test.out

#- 18 UpdateMatchmakingChannel
# body param: body
echo '{"deployment": "K7YeqH55", "description": "woG6Na8b", "findMatchTimeoutSeconds": 20, "joinable": false, "max_delay_ms": 14, "ruleSet": {"alliance": {"maxNumber": 3, "minNumber": 27, "playerMaxNumber": 1, "playerMinNumber": 13}, "alliance_flexing_rule": [{"duration": 80, "max_number": 69, "min_number": 52, "player_max_number": 75, "player_min_number": 38}, {"duration": 100, "max_number": 10, "min_number": 39, "player_max_number": 52, "player_min_number": 53}, {"duration": 20, "max_number": 72, "min_number": 53, "player_max_number": 18, "player_min_number": 97}], "flexingRules": [{"attribute": "PByk6u5C", "criteria": "Z6f4BmqZ", "duration": 72, "reference": 0.341218403554993}, {"attribute": "KMJKcV9Z", "criteria": "P2imZbNC", "duration": 79, "reference": 0.030283113834232656}, {"attribute": "jtdxqSUu", "criteria": "gPKnwkmT", "duration": 23, "reference": 0.6186147735344388}], "match_options": {"options": [{"name": "I8l9C0P1", "type": "AO9fkaBP"}, {"name": "rDEAjzHG", "type": "cvNdIUzQ"}, {"name": "bUNKlHmn", "type": "J2mYHffB"}]}, "matchingRules": [{"attribute": "vuLrH27D", "criteria": "5FEa1rcX", "reference": 0.5397809132794613}, {"attribute": "EoTPqxMG", "criteria": "w55qXwq7", "reference": 0.40712887337580994}, {"attribute": "sx4Z7NPh", "criteria": "8KpSXd20", "reference": 0.10618114619166719}], "sub_game_modes": {}}, "sessionQueueTimeoutSeconds": 84, "socialMatchmaking": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName 'm2Az4kT9' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 18 'UpdateMatchmakingChannel' test.out

#- 19 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'HhQQlVJY' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 19 'GetAllPartyInChannel' test.out

#- 20 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName '3mXC53Rr' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'GetAllSessionsInChannel' test.out

#- 21 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["fT7yW55U", "EmFyUDcT", "VOByzNYE"], "party_id": "FFpiVUHU", "user_id": "YwqpA5D7"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName 'IMM4ZaHQ' \
    --matchID 'UAbCXBe0' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 21 'AddUserIntoSessionInChannel' test.out

#- 22 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName 'ZXtk79QV' \
    --matchID 'G5od4lNS' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 22 'DeleteSessionInChannel' test.out

#- 23 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName '0KBIf5wS' \
    --matchID 'FRcOOUpo' \
    --namespace $AB_NAMESPACE \
    --userID 'fHbCkPLs' \
    > test.out 2>&1
eval_tap $? 23 'DeleteUserFromSessionInChannel' test.out

#- 24 SearchSessions
$CLI_EXE \
    --sn matchmaking \
    --op SearchSessions \
    --namespace $AB_NAMESPACE \
    --channel '4mB9nFNj' \
    --deleted 'false' \
    --matchID 'lyTuLeOz' \
    --partyID 'jyubYXYu' \
    --userID 'HgU3Vhn6' \
    --limit '15' \
    --offset '90' \
    > test.out 2>&1
eval_tap $? 24 'SearchSessions' test.out

#- 25 GetSessionHistoryDetailed
$CLI_EXE \
    --sn matchmaking \
    --op GetSessionHistoryDetailed \
    --matchID 'fRKkz4ID' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 25 'GetSessionHistoryDetailed' test.out

#- 26 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 26 'PublicGetMessages' test.out

#- 27 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'PublicGetAllMatchmakingChannel' test.out

#- 28 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'QsN0mC6Y' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'PublicGetSingleMatchmakingChannel' test.out

#- 29 SearchSessionsV2
$CLI_EXE \
    --sn matchmaking \
    --op SearchSessionsV2 \
    --namespace $AB_NAMESPACE \
    --channel '0X4qEbC8' \
    --deleted 'false' \
    --matchID 'vKumBSoN' \
    --partyID 'vnTH2sOG' \
    --userID 'a1puepl7' \
    --limit '67' \
    --offset '67' \
    > test.out 2>&1
eval_tap $? 29 'SearchSessionsV2' test.out

#- 30 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 30 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE