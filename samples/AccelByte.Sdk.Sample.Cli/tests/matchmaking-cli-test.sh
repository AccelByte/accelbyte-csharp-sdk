#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 512
# - template file: cli-test.j2

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..30"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '55' \
    --offset '85' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"deployment": "koP2O8LY", "description": "HUQLTcXq", "find_match_timeout_seconds": 9, "game_mode": "z73cgCgN", "joinable": false, "max_delay_ms": 27, "rule_set": {"alliance": {"max_number": 70, "min_number": 22, "player_max_number": 14, "player_min_number": 31}, "alliance_flexing_rule": [{"duration": 68, "max_number": 79, "min_number": 56, "player_max_number": 58, "player_min_number": 87}, {"duration": 43, "max_number": 12, "min_number": 74, "player_max_number": 57, "player_min_number": 84}, {"duration": 79, "max_number": 45, "min_number": 4, "player_max_number": 86, "player_min_number": 9}], "flexing_rule": [{"attribute": "x1XvCAD6", "criteria": "injqnydk", "duration": 4, "reference": 0.7278102114409918}, {"attribute": "ZrSqU13y", "criteria": "fqqOIlIw", "duration": 38, "reference": 0.5852000082936823}, {"attribute": "PjFt9Tn0", "criteria": "TuFnldyF", "duration": 59, "reference": 0.06419524745115868}], "match_options": {"options": [{"name": "JXZYY89q", "type": "GqmRoQiI"}, {"name": "eIBUgzHj", "type": "YS1fgxpf"}, {"name": "E9GaTwVo", "type": "ACDGw2ps"}]}, "matching_rule": [{"attribute": "kfNNdYsC", "criteria": "Z2NhRnaF", "reference": 0.7726737942604491}, {"attribute": "4zdQpsqG", "criteria": "zt9ggw8o", "reference": 0.5525871439095233}, {"attribute": "eFgnV0uf", "criteria": "IB1mo5yD", "reference": 0.29674147038065946}], "sub_game_modes": {"sfzrsTYw": {"alliance": {"max_number": 79, "min_number": 76, "player_max_number": 56, "player_min_number": 36}, "alliance_flexing_rule": [{"duration": 86, "max_number": 72, "min_number": 74, "player_max_number": 28, "player_min_number": 87}, {"duration": 4, "max_number": 18, "min_number": 36, "player_max_number": 40, "player_min_number": 58}, {"duration": 22, "max_number": 51, "min_number": 49, "player_max_number": 80, "player_min_number": 71}], "name": "a7Nukn4f"}, "pYVh1PIJ": {"alliance": {"max_number": 24, "min_number": 7, "player_max_number": 31, "player_min_number": 18}, "alliance_flexing_rule": [{"duration": 58, "max_number": 80, "min_number": 3, "player_max_number": 67, "player_min_number": 50}, {"duration": 81, "max_number": 77, "min_number": 25, "player_max_number": 7, "player_min_number": 32}, {"duration": 17, "max_number": 56, "min_number": 67, "player_max_number": 34, "player_min_number": 69}], "name": "OKf54lae"}, "zLK9MA9A": {"alliance": {"max_number": 46, "min_number": 38, "player_max_number": 95, "player_min_number": 44}, "alliance_flexing_rule": [{"duration": 45, "max_number": 73, "min_number": 45, "player_max_number": 11, "player_min_number": 86}, {"duration": 24, "max_number": 96, "min_number": 78, "player_max_number": 19, "player_min_number": 20}, {"duration": 70, "max_number": 54, "min_number": 50, "player_max_number": 90, "player_min_number": 68}], "name": "uCATG5gV"}}}, "session_queue_timeout_seconds": 71, "social_matchmaking": false, "use_sub_gamemode": true}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel 'TfAPpsPD' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'DeleteChannelHandler' test.out

#- 7 StoreMatchResults
# body param: body
echo '{"match_id": "wrxtVtgC", "players": [{"results": [{"attribute": "08GK1PkX", "value": 0.8403093663002416}, {"attribute": "XYkBk7PT", "value": 0.555964543337812}, {"attribute": "JWuhX6R9", "value": 0.9597733614075497}], "user_id": "OZHrwJz4"}, {"results": [{"attribute": "sd87tpxG", "value": 0.6500195304332339}, {"attribute": "NCx2MWjc", "value": 0.44872734011544946}, {"attribute": "ZW4K81b4", "value": 0.2538699578130922}], "user_id": "vfACsfTE"}, {"results": [{"attribute": "gtMgdTby", "value": 0.0999450003338691}, {"attribute": "8olorJpl", "value": 0.24733198099328324}, {"attribute": "svxUC9cQ", "value": 0.5396383287014169}], "user_id": "1wdi8gJp"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 7 'StoreMatchResults' test.out

#- 8 Rebalance
# body param: body
echo '{"match_id": "20WoSXy8"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'Rebalance' test.out

#- 9 QueueSessionHandler
# body param: body
echo '{"channel": "gRdCTwfD", "client_version": "2E3BuINr", "deployment": "pWfUdEpG", "game_mode": "gda2fHIo", "joinable": false, "match_id": "fMfaVl2p", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 36, "party_attributes": {"MT5EInDX": {}, "7IXUk8zD": {}, "FRgJ1pHD": {}}, "party_id": "iSlWZpX8", "party_members": [{"extra_attributes": {"VoOUZdtB": {}, "N7DYB0uC": {}, "br2OXaHG": {}}, "user_id": "D2aBNTik"}, {"extra_attributes": {"Jc64dDYq": {}, "b8IAV1NG": {}, "0wWuiyUe": {}}, "user_id": "HI33O6DW"}, {"extra_attributes": {"5YrSgVNC": {}, "3ycCVkYj": {}, "mo94Sw51": {}}, "user_id": "XsmP1k15"}]}, {"first_ticket_created_at": 88, "party_attributes": {"X3uTJo0T": {}, "3SwwJBGx": {}, "R87xRLow": {}}, "party_id": "tiluhY0o", "party_members": [{"extra_attributes": {"xvzvxUvl": {}, "USxIZ2O9": {}, "z80BQOIq": {}}, "user_id": "VVI1Muj2"}, {"extra_attributes": {"cLKBCKxc": {}, "ZPIEMvGu": {}, "YRgEymZA": {}}, "user_id": "dNnMsd76"}, {"extra_attributes": {"ZuaJ7SXH": {}, "uJvvTh2V": {}, "BJCiWRgQ": {}}, "user_id": "asWMoIDK"}]}, {"first_ticket_created_at": 9, "party_attributes": {"LGN5KrYC": {}, "XNg1S5wg": {}, "EHuUCTZs": {}}, "party_id": "l58GHCaV", "party_members": [{"extra_attributes": {"DOazxiJf": {}, "4TSm89dQ": {}, "8ZFawOVJ": {}}, "user_id": "xd7W5SNi"}, {"extra_attributes": {"oC2a6Hgv": {}, "KclYxsd2": {}, "0vThsoaM": {}}, "user_id": "G8Srei5y"}, {"extra_attributes": {"dxJONE5i": {}, "p748zZEM": {}, "EjGLiGBN": {}}, "user_id": "IKdR2msG"}]}]}, {"matching_parties": [{"first_ticket_created_at": 7, "party_attributes": {"evRtmHV6": {}, "Kfm1xYsr": {}, "YgOOSO1z": {}}, "party_id": "Ln71kHmR", "party_members": [{"extra_attributes": {"YXqIVvRt": {}, "ABoUb4Z6": {}, "dV7u2iHl": {}}, "user_id": "E2443jsE"}, {"extra_attributes": {"M42zPtDV": {}, "4MIkPfeW": {}, "L31lPhNP": {}}, "user_id": "NlQBOhwM"}, {"extra_attributes": {"tmM9iijY": {}, "WyqPuWQC": {}, "Z39oh0YM": {}}, "user_id": "2IStit4V"}]}, {"first_ticket_created_at": 67, "party_attributes": {"PEo1dA2H": {}, "hcxb2plz": {}, "KshEpntw": {}}, "party_id": "qbilfS12", "party_members": [{"extra_attributes": {"ov9rF3fY": {}, "uww54Q8Y": {}, "WFUMAvob": {}}, "user_id": "hWLKrXWs"}, {"extra_attributes": {"zdnrSfD7": {}, "36FbFxGL": {}, "Vug09lLo": {}}, "user_id": "ve3pCCvm"}, {"extra_attributes": {"0R3TnibA": {}, "MSVsBrZe": {}, "0VosoXGk": {}}, "user_id": "5gIRCU4L"}]}, {"first_ticket_created_at": 92, "party_attributes": {"TjVes89Q": {}, "dCY1sQKP": {}, "w7GihaCR": {}}, "party_id": "OoSxaf4T", "party_members": [{"extra_attributes": {"0JwCJOcw": {}, "X54zgHl4": {}, "sqRwOrkr": {}}, "user_id": "Ix9AmqQg"}, {"extra_attributes": {"rhKBKI02": {}, "rhu0kQbx": {}, "p8SQqIHr": {}}, "user_id": "l0PsJftE"}, {"extra_attributes": {"J3cgGDWg": {}, "yRKZnyaq": {}, "I8XbXOkI": {}}, "user_id": "91WywjjE"}]}]}, {"matching_parties": [{"first_ticket_created_at": 84, "party_attributes": {"NyAz1u0L": {}, "nKmrd9QI": {}, "4POjZUCR": {}}, "party_id": "28QEm5kH", "party_members": [{"extra_attributes": {"MBrmv8v3": {}, "JdWeRarI": {}, "A7nkywjM": {}}, "user_id": "Di1Wh8zQ"}, {"extra_attributes": {"43GgUblL": {}, "uZUZwjlp": {}, "R5thIU8Q": {}}, "user_id": "ayzNBQZ9"}, {"extra_attributes": {"BHEcwwGg": {}, "MPbuTQbI": {}, "PWM1fJJ6": {}}, "user_id": "JImurXpy"}]}, {"first_ticket_created_at": 51, "party_attributes": {"aN5mONlf": {}, "YWhG9cza": {}, "L1LoimWQ": {}}, "party_id": "tEE4HcvA", "party_members": [{"extra_attributes": {"OIC2O0jv": {}, "lMGcklkY": {}, "psGy7eKl": {}}, "user_id": "nMGktFsS"}, {"extra_attributes": {"Lhzw61ui": {}, "51vqcqvw": {}, "2qTvSuJv": {}}, "user_id": "9znc4DIK"}, {"extra_attributes": {"oK5Aga5S": {}, "QvZc7jc7": {}, "YwL8fPvF": {}}, "user_id": "s1lNgHfh"}]}, {"first_ticket_created_at": 78, "party_attributes": {"4HbYm0OH": {}, "dObMpIv1": {}, "pHu67fCG": {}}, "party_id": "VUpuEZWS", "party_members": [{"extra_attributes": {"Dlvd8Zb7": {}, "w1037ZFT": {}, "vbKQqyi4": {}}, "user_id": "oqYpeOV9"}, {"extra_attributes": {"jgIdXTId": {}, "TTgXb8LM": {}, "3VP8PBk1": {}}, "user_id": "5cCSPeSu"}, {"extra_attributes": {"rHIbx45P": {}, "L2gSbyTy": {}, "gENcvc7F": {}}, "user_id": "YrpjlCPm"}]}]}], "namespace": "fCK0Zho0", "party_attributes": {"8rgkW0AF": {}, "Avjp5ed0": {}, "bFLtNmGl": {}}, "party_id": "2UM24rLf", "queued_at": 9, "region": "JLqvqMKL", "server_name": "YSIs7uq7", "status": "PaQ7OSix", "updated_at": "1997-09-12T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'QueueSessionHandler' test.out

#- 10 DequeueSessionHandler
# body param: body
echo '{"match_id": "OdvkRCnc"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'DequeueSessionHandler' test.out

#- 11 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'klnV71Hm' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 11 'QuerySessionHandler' test.out

#- 12 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 100, "userID": "am3uaAv5", "weight": 0.06634169079098173}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 12 'UpdatePlayTimeWeight' test.out

#- 13 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 13 'GetAllPartyInAllChannel' test.out

#- 14 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs 'BWVNqyZH' \
    > test.out 2>&1
eval_tap $? 14 'BulkGetSessions' test.out

#- 15 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 15 'ExportChannels' test.out

#- 16 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload $TEMP_FILE_UPLOAD \
    --strategy 'u1xe3qO9' \
    > test.out 2>&1
eval_tap $? 16 'ImportChannels' test.out

#- 17 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName 'tk4BtkQs' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 17 'GetSingleMatchmakingChannel' test.out

#- 18 UpdateMatchmakingChannel
# body param: body
echo '{"deployment": "0jr7FijX", "description": "1e5qI3aB", "findMatchTimeoutSeconds": 62, "joinable": true, "max_delay_ms": 81, "ruleSet": {"alliance": {"maxNumber": 41, "minNumber": 79, "playerMaxNumber": 39, "playerMinNumber": 97}, "alliance_flexing_rule": [{"duration": 12, "max_number": 63, "min_number": 35, "player_max_number": 82, "player_min_number": 19}, {"duration": 25, "max_number": 7, "min_number": 8, "player_max_number": 60, "player_min_number": 15}, {"duration": 83, "max_number": 7, "min_number": 73, "player_max_number": 11, "player_min_number": 96}], "flexingRules": [{"attribute": "rFi1xokq", "criteria": "hCCcZeAf", "duration": 83, "reference": 0.6297533060498484}, {"attribute": "Icq5n3kk", "criteria": "a9q5g2Io", "duration": 54, "reference": 0.9861124056794485}, {"attribute": "EKqyqjLe", "criteria": "0plgIqxf", "duration": 69, "reference": 0.6636601802868719}], "match_options": {"options": [{"name": "EP1QANKb", "type": "PXQkT8TO"}, {"name": "eQ7DSgyC", "type": "kzClCvqZ"}, {"name": "aOmIZ8yu", "type": "jrN1pw3p"}]}, "matchingRules": [{"attribute": "fYTwpVkl", "criteria": "e0lVLpUe", "reference": 0.8332590799071001}, {"attribute": "dy9ZKO5y", "criteria": "c2Ihe0hL", "reference": 0.7224432897934608}, {"attribute": "vbffucvo", "criteria": "ocroUsyH", "reference": 0.9175654297494404}], "sub_game_modes": {}}, "sessionQueueTimeoutSeconds": 50, "socialMatchmaking": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName 'vab1JMin' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 18 'UpdateMatchmakingChannel' test.out

#- 19 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'qkqBeh7O' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 19 'GetAllPartyInChannel' test.out

#- 20 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName 'HjT7V9QP' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'GetAllSessionsInChannel' test.out

#- 21 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["qM004kNj", "ygB1Hs3S", "XO1emRu2"], "party_id": "q1yAhYhN", "user_id": "A24N43Uc"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName '7r3oDLd0' \
    --matchID '7q4gyYwa' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 21 'AddUserIntoSessionInChannel' test.out

#- 22 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName 'K2tpvwhm' \
    --matchID 'wH04Zur3' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 22 'DeleteSessionInChannel' test.out

#- 23 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName 'cR69o1ju' \
    --matchID 'OxuR0IMh' \
    --namespace $AB_NAMESPACE \
    --userID 'AnwZkzf5' \
    > test.out 2>&1
eval_tap $? 23 'DeleteUserFromSessionInChannel' test.out

#- 24 SearchSessions
$CLI_EXE \
    --sn matchmaking \
    --op SearchSessions \
    --namespace $AB_NAMESPACE \
    --channel 'UuYZojLb' \
    --deleted 'true' \
    --matchID 'RaC095Ov' \
    --partyID 'NnZpZh5J' \
    --userID 'Y5vXfjcS' \
    --limit '8' \
    --offset '17' \
    > test.out 2>&1
eval_tap $? 24 'SearchSessions' test.out

#- 25 GetSessionHistoryDetailed
$CLI_EXE \
    --sn matchmaking \
    --op GetSessionHistoryDetailed \
    --matchID 'TNmBFec0' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 25 'GetSessionHistoryDetailed' test.out

#- 26 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 26 'PublicGetMessages' test.out

#- 27 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'PublicGetAllMatchmakingChannel' test.out

#- 28 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'zuf42n0W' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'PublicGetSingleMatchmakingChannel' test.out

#- 29 SearchSessionsV2
$CLI_EXE \
    --sn matchmaking \
    --op SearchSessionsV2 \
    --namespace $AB_NAMESPACE \
    --channel '3NmJTl8m' \
    --deleted 'false' \
    --matchID 'yyph3fE6' \
    --partyID 'tZ2WwcmQ' \
    --userID 'xP3Cfk9r' \
    --limit '69' \
    --offset '100' \
    > test.out 2>&1
eval_tap $? 29 'SearchSessionsV2' test.out

#- 30 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 30 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE