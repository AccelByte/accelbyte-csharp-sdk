#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 512
# - template file: cli-test.j2

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..30"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '38' \
    --offset '51' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"deployment": "KkG1blCg", "description": "mXOz7rnV", "find_match_timeout_seconds": 63, "game_mode": "gsHwI483", "joinable": false, "max_delay_ms": 94, "rule_set": {"alliance": {"max_number": 77, "min_number": 90, "player_max_number": 9, "player_min_number": 4}, "alliance_flexing_rule": [{"duration": 23, "max_number": 73, "min_number": 94, "player_max_number": 65, "player_min_number": 68}, {"duration": 14, "max_number": 4, "min_number": 24, "player_max_number": 39, "player_min_number": 46}, {"duration": 1, "max_number": 24, "min_number": 69, "player_max_number": 71, "player_min_number": 38}], "flexing_rule": [{"attribute": "kqLRtev1", "criteria": "Lif26I4T", "duration": 19, "reference": 0.8397721338732549}, {"attribute": "qRoQfvDv", "criteria": "LU2jCG9b", "duration": 67, "reference": 0.6338528029257142}, {"attribute": "6OMtXGiy", "criteria": "77zGZP6s", "duration": 7, "reference": 0.38647726761208856}], "match_options": {"options": [{"name": "Nq1Vb6Rl", "type": "VoSbZuHi"}, {"name": "q2Sx9n6b", "type": "4B1YZxgU"}, {"name": "t3d3cd4p", "type": "euhfna6P"}]}, "matching_rule": [{"attribute": "6kXkK689", "criteria": "zMWEkaeZ", "reference": 0.22367056996007828}, {"attribute": "IZXOyzpb", "criteria": "vfZEDqXt", "reference": 0.46641269700206345}, {"attribute": "UcydL1fd", "criteria": "SPKrC7ux", "reference": 0.9756259192248564}], "sub_game_modes": {"x4MDgEun": {"alliance": {"max_number": 51, "min_number": 80, "player_max_number": 43, "player_min_number": 73}, "alliance_flexing_rule": [{"duration": 52, "max_number": 36, "min_number": 18, "player_max_number": 26, "player_min_number": 48}, {"duration": 99, "max_number": 21, "min_number": 21, "player_max_number": 83, "player_min_number": 78}, {"duration": 64, "max_number": 18, "min_number": 71, "player_max_number": 99, "player_min_number": 57}], "name": "wnfj2jC8"}, "QOc012DT": {"alliance": {"max_number": 3, "min_number": 65, "player_max_number": 59, "player_min_number": 67}, "alliance_flexing_rule": [{"duration": 97, "max_number": 1, "min_number": 10, "player_max_number": 54, "player_min_number": 8}, {"duration": 2, "max_number": 92, "min_number": 92, "player_max_number": 17, "player_min_number": 97}, {"duration": 3, "max_number": 38, "min_number": 78, "player_max_number": 62, "player_min_number": 43}], "name": "1NEsfZzM"}, "gcvkc5PF": {"alliance": {"max_number": 7, "min_number": 78, "player_max_number": 46, "player_min_number": 73}, "alliance_flexing_rule": [{"duration": 92, "max_number": 86, "min_number": 82, "player_max_number": 28, "player_min_number": 31}, {"duration": 16, "max_number": 86, "min_number": 85, "player_max_number": 81, "player_min_number": 23}, {"duration": 13, "max_number": 20, "min_number": 38, "player_max_number": 70, "player_min_number": 37}], "name": "C02iCZlv"}}}, "session_queue_timeout_seconds": 73, "social_matchmaking": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel 'g3MJeMvK' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'DeleteChannelHandler' test.out

#- 7 StoreMatchResults
# body param: body
echo '{"match_id": "kf70JRM6", "players": [{"results": [{"attribute": "EupWBmEV", "value": 0.32992380354999373}, {"attribute": "dN9DhZ3n", "value": 0.3195034832784396}, {"attribute": "fMmWt9Rj", "value": 0.5538230334940689}], "user_id": "gdfU77Bc"}, {"results": [{"attribute": "yP0xZYQb", "value": 0.6772393858679885}, {"attribute": "Am7XSLQW", "value": 0.38228367917360895}, {"attribute": "8rUvye2j", "value": 0.15053123381309375}], "user_id": "33G7pkOI"}, {"results": [{"attribute": "dwTeiudg", "value": 0.37646107516297145}, {"attribute": "xKUjT8o6", "value": 0.18299092437833453}, {"attribute": "jFI0AZA8", "value": 0.6959323338855015}], "user_id": "HfHkpyDR"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 7 'StoreMatchResults' test.out

#- 8 Rebalance
# body param: body
echo '{"match_id": "N3hmbtOP"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'Rebalance' test.out

#- 9 QueueSessionHandler
# body param: body
echo '{"channel": "iL8jK7Kf", "client_version": "JoZv7I8T", "deployment": "e5JSgP07", "game_mode": "JQWV3Exq", "joinable": true, "match_id": "x3qd9RxP", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 84, "party_attributes": {"igm8QYZt": {}, "o7IYfBO4": {}, "4m0RYnQm": {}}, "party_id": "OiFSqWdf", "party_members": [{"extra_attributes": {"oMbINCyp": {}, "SKDR5lSU": {}, "59KZ5sw1": {}}, "user_id": "9GreqMFK"}, {"extra_attributes": {"AF6deFEI": {}, "TRpQzJSv": {}, "oFVOIY8M": {}}, "user_id": "Lq8PC005"}, {"extra_attributes": {"boUw4daf": {}, "1u2NCpLH": {}, "bx6E31JI": {}}, "user_id": "UZlVzVa3"}]}, {"first_ticket_created_at": 37, "party_attributes": {"cnVoFu2J": {}, "toEiz7sg": {}, "RjV9DLae": {}}, "party_id": "AMAhR4kA", "party_members": [{"extra_attributes": {"pdQbAyqP": {}, "R9HONADV": {}, "5kONz6tt": {}}, "user_id": "W7jRsEqJ"}, {"extra_attributes": {"17LnzpJw": {}, "UozvmZSb": {}, "44b7o0Xf": {}}, "user_id": "lUHZTto9"}, {"extra_attributes": {"XvRvPD6F": {}, "LjKbhTvp": {}, "ZVklOkKU": {}}, "user_id": "rLgx95A2"}]}, {"first_ticket_created_at": 98, "party_attributes": {"LgPcJjRJ": {}, "CGTXFtuh": {}, "RJjAEZrf": {}}, "party_id": "Uyg2Wb3C", "party_members": [{"extra_attributes": {"1JMPBFkT": {}, "ntCqcpIN": {}, "McDL7Fit": {}}, "user_id": "B1aJfpon"}, {"extra_attributes": {"dIPt6rwy": {}, "y2DaYbdE": {}, "1D7oqIua": {}}, "user_id": "kKRcsDJl"}, {"extra_attributes": {"5G5JSDZY": {}, "lZ6F7Kpo": {}, "Z57nH7mX": {}}, "user_id": "UhJtQ0wU"}]}]}, {"matching_parties": [{"first_ticket_created_at": 45, "party_attributes": {"FvIkVoP0": {}, "WJhJWzXU": {}, "6sD9dLmo": {}}, "party_id": "rDGNYlgD", "party_members": [{"extra_attributes": {"GZxVEOAF": {}, "eKU1Xhit": {}, "2BOEHXtf": {}}, "user_id": "GqXISfTn"}, {"extra_attributes": {"YbeC4jMK": {}, "uB2MHFdW": {}, "QPyswPqQ": {}}, "user_id": "f0Uf10SL"}, {"extra_attributes": {"pfAcpvTF": {}, "idJVWFpJ": {}, "RffQ90cd": {}}, "user_id": "ggVw6ovv"}]}, {"first_ticket_created_at": 84, "party_attributes": {"mE0WeX39": {}, "qwHITpAm": {}, "tH8chtbu": {}}, "party_id": "EReZDNIU", "party_members": [{"extra_attributes": {"i4krf8eE": {}, "t3TzHca1": {}, "tfyVtHUo": {}}, "user_id": "TEkJmQvJ"}, {"extra_attributes": {"3kovpFZZ": {}, "NCfHPfgK": {}, "o1VmF5q9": {}}, "user_id": "00XUTvH9"}, {"extra_attributes": {"zwikUAEI": {}, "sTjpdbVd": {}, "ZWr936bA": {}}, "user_id": "LeBBxbs3"}]}, {"first_ticket_created_at": 58, "party_attributes": {"jmgxT18p": {}, "MGV7RJBI": {}, "o6CZwcvQ": {}}, "party_id": "pkdNi2lk", "party_members": [{"extra_attributes": {"rZuCgaE2": {}, "g3oLzRSF": {}, "SyXuYhMv": {}}, "user_id": "bWlShdCB"}, {"extra_attributes": {"nYMT4GpK": {}, "MrlN8Hci": {}, "BAlagxJe": {}}, "user_id": "o09qSN9E"}, {"extra_attributes": {"Oc7Ae5HG": {}, "97l1j4L6": {}, "GmV6xPEf": {}}, "user_id": "oHWdLjye"}]}]}, {"matching_parties": [{"first_ticket_created_at": 15, "party_attributes": {"2WVv6rbo": {}, "RYdnhkFK": {}, "ufqskGzr": {}}, "party_id": "qU9eAgMA", "party_members": [{"extra_attributes": {"mTtpU9AT": {}, "WhQG7O2l": {}, "hdegZlNK": {}}, "user_id": "LNFBEqNs"}, {"extra_attributes": {"Jw73IvgJ": {}, "IP7ezLSM": {}, "Mep5VJiz": {}}, "user_id": "NjE9fhKb"}, {"extra_attributes": {"qq2FgzOC": {}, "MBr7dWys": {}, "j5Eu5kIS": {}}, "user_id": "cPblVSJk"}]}, {"first_ticket_created_at": 28, "party_attributes": {"ZyVwpwOm": {}, "EloNmwMA": {}, "zz3O7lZB": {}}, "party_id": "0Xht0KIK", "party_members": [{"extra_attributes": {"ctxZ9hs5": {}, "vEihlWZ8": {}, "ruOgQ9Ck": {}}, "user_id": "GW9WN7LF"}, {"extra_attributes": {"OPv01dvo": {}, "5GhSqxMX": {}, "cEpqH3mo": {}}, "user_id": "XAH72rDY"}, {"extra_attributes": {"V8EAfF9F": {}, "ky85lTwQ": {}, "HJG1Q8iP": {}}, "user_id": "Fm4x7Q8B"}]}, {"first_ticket_created_at": 74, "party_attributes": {"ZzQngqaP": {}, "zhN0uffI": {}, "pnzbz2qR": {}}, "party_id": "FYKMnJPg", "party_members": [{"extra_attributes": {"4U0QyTSK": {}, "YnVrUQo5": {}, "wnQRKSwj": {}}, "user_id": "mzt7Y9nO"}, {"extra_attributes": {"GP54cxok": {}, "337PzXVd": {}, "TScgJWsB": {}}, "user_id": "tIwwxmqa"}, {"extra_attributes": {"qEoJdWaw": {}, "FaDOP5pu": {}, "WhGhAn4J": {}}, "user_id": "dxHX8W79"}]}]}], "namespace": "AypPVq02", "party_attributes": {"rZkUqgOd": {}, "jxAypQ1R": {}, "WYwsdqyW": {}}, "party_id": "55oVjeU8", "queued_at": 30, "region": "3hVpdSpS", "server_name": "cprGEV7F", "status": "mHhcFXf1", "updated_at": "1996-11-08T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'QueueSessionHandler' test.out

#- 10 DequeueSessionHandler
# body param: body
echo '{"match_id": "UYXobIKN"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'DequeueSessionHandler' test.out

#- 11 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'kI6CvLIA' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 11 'QuerySessionHandler' test.out

#- 12 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 20, "userID": "yhjt3HJt", "weight": 0.5517428503677576}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 12 'UpdatePlayTimeWeight' test.out

#- 13 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 13 'GetAllPartyInAllChannel' test.out

#- 14 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs 'lr2JCvVH' \
    > test.out 2>&1
eval_tap $? 14 'BulkGetSessions' test.out

#- 15 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 15 'ExportChannels' test.out

#- 16 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload $TEMP_FILE_UPLOAD \
    --strategy 'jLBb98Lj' \
    > test.out 2>&1
eval_tap $? 16 'ImportChannels' test.out

#- 17 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName 'jmN6cUZ1' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 17 'GetSingleMatchmakingChannel' test.out

#- 18 UpdateMatchmakingChannel
# body param: body
echo '{"deployment": "xE1Lsatk", "description": "bL482hUX", "findMatchTimeoutSeconds": 48, "joinable": true, "max_delay_ms": 58, "ruleSet": {"alliance": {"maxNumber": 55, "minNumber": 40, "playerMaxNumber": 19, "playerMinNumber": 76}, "alliance_flexing_rule": [{"duration": 61, "max_number": 3, "min_number": 96, "player_max_number": 30, "player_min_number": 98}, {"duration": 1, "max_number": 31, "min_number": 8, "player_max_number": 53, "player_min_number": 47}, {"duration": 35, "max_number": 14, "min_number": 69, "player_max_number": 14, "player_min_number": 75}], "flexingRules": [{"attribute": "GvQkiE5B", "criteria": "gAjKcixw", "duration": 74, "reference": 0.22097386968779986}, {"attribute": "AVVDvUHq", "criteria": "RmXqmMwy", "duration": 7, "reference": 0.4438066928453046}, {"attribute": "a4LX39SZ", "criteria": "GB5FHYax", "duration": 96, "reference": 0.30649288639838956}], "match_options": {"options": [{"name": "qNc5JStS", "type": "Q395zYYz"}, {"name": "1CSS32cQ", "type": "mnEVXn8i"}, {"name": "sRM8jiYH", "type": "bGPasvYc"}]}, "matchingRules": [{"attribute": "kWnPDX9q", "criteria": "bcz6OTu6", "reference": 0.9058191562950796}, {"attribute": "Cd30PXDn", "criteria": "cFiJJ9jm", "reference": 0.8953654424544208}, {"attribute": "SH8UgyyE", "criteria": "tJ8OzUUb", "reference": 0.7581824180957311}], "sub_game_modes": {}}, "sessionQueueTimeoutSeconds": 30, "socialMatchmaking": true, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName '9w36qK16' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 18 'UpdateMatchmakingChannel' test.out

#- 19 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'iOxrHyUx' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 19 'GetAllPartyInChannel' test.out

#- 20 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName 'xhwEIk6z' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'GetAllSessionsInChannel' test.out

#- 21 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["5KJt0sdt", "UbZqYwGy", "voiZwiMH"], "party_id": "5r50ifBm", "user_id": "3v8CpwrQ"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName 'RXg2OtOk' \
    --matchID 'PcwaZjNm' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 21 'AddUserIntoSessionInChannel' test.out

#- 22 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName 'EWoIACuC' \
    --matchID 'P83Mi7Xk' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 22 'DeleteSessionInChannel' test.out

#- 23 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName 'fVXj3JJi' \
    --matchID 'NcvI8KX0' \
    --namespace $AB_NAMESPACE \
    --userID 'hx7Gw5ja' \
    > test.out 2>&1
eval_tap $? 23 'DeleteUserFromSessionInChannel' test.out

#- 24 SearchSessions
$CLI_EXE \
    --sn matchmaking \
    --op SearchSessions \
    --namespace $AB_NAMESPACE \
    --channel '161p34sl' \
    --deleted 'false' \
    --matchID '7K9BVVzG' \
    --partyID 'IomHbwgY' \
    --userID 'xpAxVc0D' \
    --limit '56' \
    --offset '52' \
    > test.out 2>&1
eval_tap $? 24 'SearchSessions' test.out

#- 25 GetSessionHistoryDetailed
$CLI_EXE \
    --sn matchmaking \
    --op GetSessionHistoryDetailed \
    --matchID 'Zo9VlUkO' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 25 'GetSessionHistoryDetailed' test.out

#- 26 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 26 'PublicGetMessages' test.out

#- 27 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'PublicGetAllMatchmakingChannel' test.out

#- 28 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'qrlcFydE' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'PublicGetSingleMatchmakingChannel' test.out

#- 29 SearchSessionsV2
$CLI_EXE \
    --sn matchmaking \
    --op SearchSessionsV2 \
    --namespace $AB_NAMESPACE \
    --channel 'Ql7NHQkg' \
    --deleted 'true' \
    --matchID 'wViHABuB' \
    --partyID 'O8Cfp2as' \
    --userID 'OqNGsE0u' \
    --limit '30' \
    --offset '95' \
    > test.out 2>&1
eval_tap $? 29 'SearchSessionsV2' test.out

#- 30 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 30 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE